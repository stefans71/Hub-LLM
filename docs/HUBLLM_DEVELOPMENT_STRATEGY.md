# HubLLM Development Strategy
## Applying Anthropic's Harness Research to Your Project

---

## 1. Key Insights from Anthropic's Harness Paper

### The Core Problem Anthropic Solved
Long-running AI agents fail in two predictable ways:
1. **One-shotting** - Trying to build everything at once, running out of context mid-feature
2. **Premature completion** - Declaring victory when the project is only partially done

### The Solution: Two-Agent Harness Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INITIALIZER AGENT                        â”‚
â”‚  Runs ONCE on first session                                 â”‚
â”‚  Creates:                                                   â”‚
â”‚  â€¢ feature_list.json (200+ testable features)              â”‚
â”‚  â€¢ init.sh (how to run the project)                        â”‚
â”‚  â€¢ claude-progress.txt (session handoff log)               â”‚
â”‚  â€¢ Initial git commit                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CODING AGENT                            â”‚
â”‚  Runs on EVERY subsequent session                           â”‚
â”‚  1. Read progress file + git log                           â”‚
â”‚  2. Run init.sh to verify app works                        â”‚
â”‚  3. Pick ONE feature from feature_list.json                â”‚
â”‚  4. Implement + test with browser automation               â”‚
â”‚  5. Commit to git + update progress file                   â”‚
â”‚  6. Leave code in "mergeable" state                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Files for Session Handoffs

| File | Purpose |
|------|---------|
| `feature_list.json` | Comprehensive features, each marked `passes: true/false` |
| `claude-progress.txt` | Human-readable log of what each session accomplished |
| `init.sh` | Script to start dev server, run tests |
| `.git/` | Full history for reverting bad changes |

---

## 2. Component Mapping: HTML Mockup â†’ React â†’ Backend

### Views (Main Pages)

| HTML Mockup ID | React Component | Backend Endpoints |
|----------------|-----------------|-------------------|
| `view-dashboard` | `Dashboard.jsx` | `GET /api/projects`, `GET /api/usage` |
| `view-settings` | `Settings.jsx` | `GET/PUT /api/user/settings` |
| `view-create-project` | `CreateProject.jsx` | `POST /api/projects` |
| `view-workspace` | `Workspace.jsx` | `WS /api/ssh`, `GET /api/files` |

### Create Project Flow (Step-by-Step)

| Step | HTML IDs | React Component | Backend |
|------|----------|-----------------|---------|
| **1. Project Details** | `project-brief`, `brief-file-upload` | `ProjectBrief.jsx` | `POST /api/ai/expand-brief` |
| **2. Connection Source** | `github-card`, `github-connected`, `vps-card`, `fields-vps` | `ConnectionSource.jsx` | `GET /api/auth/oauth/github`, `POST /api/servers` |
| **3. Project Context** | `ctx-tech-stack`, `ctx-standards` | `ProjectContext.jsx` | Generated by AI, stored in project |
| **4. Project Agents** | `global-agents-list` | `AgentSelector.jsx` | `GET /api/agents`, `POST /api/projects/{id}/agents` |
| **5. MCP Servers** | `global-mcp-list` | `MCPSelector.jsx` | `GET /api/mcp-servers`, `POST /api/projects/{id}/mcp` |

### Settings Sections

| HTML ID | React Component | Backend |
|---------|-----------------|---------|
| `settings-subscription` | `SubscriptionSettings.jsx` | `GET /api/user/subscription` |
| `settings-apikeys` | `APIKeySettings.jsx` | BYOK (client-side only) |
| `settings-model` | `ModelSettings.jsx` | `GET /api/chat/models` |
| `settings-vps` | `VPSSettings.jsx` | `GET/POST /api/servers` |
| `settings-profile` | `ProfileSettings.jsx` | `GET/PUT /api/auth/me` |
| `settings-globalagents` | `GlobalAgents.jsx` | `GET/POST /api/agents` |
| `settings-globalskills` | `GlobalSkills.jsx` | `GET/POST /api/skills` |
| `settings-globalmcp` | `GlobalMCP.jsx` | `GET/POST /api/mcp-servers` |

### Workspace Components

| HTML Element | React Component | Backend |
|--------------|-----------------|---------|
| Terminal (xterm.js) | `Terminal.jsx` âœ… | `WS /api/ssh/terminal` |
| File Browser | `FileBrowser.jsx` âœ… | `GET /api/ssh/files` |
| Code Editor (Monaco) | `CodeEditor.jsx` âœ… | `GET/PUT /api/ssh/file` |
| AI Chat Panel | `Chat.jsx` âœ… | `POST /api/chat/completions` |
| Preview Panel | `PreviewPanel.jsx` | `GET /api/preview/url` (Codespaces) |
| Model Selector | `ModelSelector.jsx` âœ… | `GET /api/chat/models` |

---

## 3. Development Workflow with Claude CLI in Codespaces

### Recommended Setup

```bash
# In your Codespace terminal
npm install -g @anthropic-ai/claude-code

# Initialize harness files (do this ONCE)
claude --init-harness
```

### Create These Harness Files

#### `feature_list.json`
```json
{
  "project": "HubLLM",
  "features": [
    {
      "id": "auth-001",
      "category": "authentication",
      "description": "User can sign up with email/password",
      "steps": [
        "Navigate to /signup",
        "Fill in email, password, confirm password",
        "Click Sign Up",
        "Verify redirect to dashboard"
      ],
      "passes": true
    },
    {
      "id": "auth-002", 
      "category": "authentication",
      "description": "User can login with GitHub OAuth",
      "steps": [
        "Navigate to /login",
        "Click 'Sign in with GitHub'",
        "Complete OAuth flow",
        "Verify redirect to dashboard with user info"
      ],
      "passes": true
    },
    {
      "id": "project-001",
      "category": "project-creation",
      "description": "User can create a new project with AI brief expansion",
      "steps": [
        "Click Create Project",
        "Enter project brief",
        "Click 'Define Project with AI'",
        "Verify AI generates tech stack, standards, agents"
      ],
      "passes": false
    },
    {
      "id": "github-001",
      "category": "github-integration",
      "description": "User can connect GitHub and select repository",
      "steps": [
        "In Create Project, click 'Sign in with GitHub'",
        "Complete OAuth flow",
        "See connected state with avatar",
        "Select repository from dropdown"
      ],
      "passes": false
    }
  ]
}
```

#### `claude-progress.txt`
```
# HubLLM Development Progress

## Session 1 - 2026-01-23
- Completed: OAuth flow for GitHub and Google
- Status: Authentication fully working
- Next: Implement Create Project flow

## Session 2 - [DATE]
- Working on: [FEATURE]
- Completed: [WHAT]
- Issues: [ANY BLOCKERS]
- Next: [WHAT'S NEXT]
```

#### `init.sh`
```bash
#!/bin/bash

# HubLLM Development Server Startup

echo "Starting PostgreSQL..."
docker compose up db -d

echo "Starting Backend..."
cd backend
source venv/bin/activate
uvicorn main:app --reload &
BACKEND_PID=$!

echo "Starting Frontend..."
cd ../frontend
npm run dev &
FRONTEND_PID=$!

echo "Waiting for services..."
sleep 5

echo "Running health check..."
curl -s http://localhost:8000/health | jq .

echo "HubLLM ready at http://localhost:5173"
echo "Backend PID: $BACKEND_PID"
echo "Frontend PID: $FRONTEND_PID"
```

### Claude CLI Workflow

```bash
# Start a session
claude

# Claude will automatically:
# 1. Read claude-progress.txt
# 2. Read feature_list.json
# 3. Check git log
# 4. Pick next feature to work on

# Example prompt:
> Continue working on HubLLM. Check progress and implement the next failing feature.

# End of session - Claude commits and updates progress
```

---

## 4. Multi-Agent Architecture for HubLLM

Based on Anthropic's multi-agent research, here's a recommended architecture:

### Lead Agent (Orchestrator)
```
Role: Project Manager
Model: claude-sonnet-4
Responsibilities:
- Decompose user requests into subtasks
- Assign tasks to specialized agents
- Synthesize results
- Maintain project context
```

### Specialized Subagents

| Agent | Model | Role | Tools |
|-------|-------|------|-------|
| **code-reviewer** | claude-sonnet-4 | Reviews PRs, suggests improvements | `read_file`, `git_diff` |
| **test-writer** | claude-sonnet-4 | Writes unit/integration tests | `write_file`, `run_tests` |
| **frontend-dev** | claude-sonnet-4 | React/CSS implementation | `write_file`, `browser_preview` |
| **backend-dev** | claude-sonnet-4 | FastAPI/Python implementation | `write_file`, `run_server` |
| **docs-writer** | claude-haiku-4 | Documentation, comments | `write_file` |
| **debugger** | claude-sonnet-4 | Investigates and fixes bugs | `read_logs`, `browser_inspect` |

### Agent Configuration in HubLLM

```json
{
  "agents": [
    {
      "id": "code-reviewer",
      "name": "Code Reviewer",
      "description": "Reviews code for quality, security, and best practices",
      "model": "anthropic/claude-sonnet-4",
      "system_prompt": "You are a senior code reviewer...",
      "tools": ["readonly"],
      "enabled": true
    },
    {
      "id": "frontend-dev",
      "name": "Frontend Developer", 
      "description": "Implements React components and styling",
      "model": "anthropic/claude-sonnet-4",
      "system_prompt": "You are a frontend developer specializing in React...",
      "tools": ["write", "preview"],
      "enabled": true
    }
  ]
}
```

---

## 5. New Backend Endpoints Needed

### AI/Agent Endpoints
```
POST /api/ai/expand-brief
  Input: { brief: string, model: string }
  Output: { tech_stack, standards, suggested_agents, context }

POST /api/ai/generate-context
  Input: { brief: string, tech_stack: string }
  Output: { claude_md: string, agents_md: string }

POST /api/agents
  Input: { name, description, model, system_prompt, tools }
  Output: { id, ...agent }

GET /api/agents
  Output: [{ id, name, description, model, enabled }]

POST /api/projects/{id}/agents
  Input: { agent_ids: string[] }
  Output: { project_id, agents: [] }
```

### MCP Server Endpoints
```
GET /api/mcp-servers
  Output: [{ id, name, type, config, enabled }]

POST /api/mcp-servers
  Input: { name, type, config }
  Output: { id, ...server }

POST /api/projects/{id}/mcp
  Input: { mcp_ids: string[] }
  Output: { project_id, mcp_servers: [] }
```

### GitHub Codespaces Endpoints (Expand existing)
```
POST /api/github/codespaces/{id}/start
POST /api/github/codespaces/{id}/stop
GET /api/github/codespaces/{id}/status
GET /api/github/codespaces/{id}/preview-url
```

---

## 6. Database Schema Additions

```sql
-- Agents table
CREATE TABLE agents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    model VARCHAR(100) NOT NULL,
    system_prompt TEXT,
    tools JSONB DEFAULT '[]',
    is_global BOOLEAN DEFAULT false,
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Project-Agent association
CREATE TABLE project_agents (
    project_id UUID REFERENCES projects(id),
    agent_id UUID REFERENCES agents(id),
    enabled BOOLEAN DEFAULT true,
    PRIMARY KEY (project_id, agent_id)
);

-- MCP Servers table
CREATE TABLE mcp_servers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    name VARCHAR(100) NOT NULL,
    type VARCHAR(50) NOT NULL, -- filesystem, github, postgres, etc.
    config JSONB NOT NULL,
    is_global BOOLEAN DEFAULT false,
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Project-MCP association
CREATE TABLE project_mcp_servers (
    project_id UUID REFERENCES projects(id),
    mcp_server_id UUID REFERENCES mcp_servers(id),
    enabled BOOLEAN DEFAULT true,
    PRIMARY KEY (project_id, mcp_server_id)
);

-- Skills table
CREATE TABLE skills (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    skill_type VARCHAR(50), -- writing, coding, research, etc.
    content TEXT NOT NULL, -- The skill prompt/instructions
    is_global BOOLEAN DEFAULT false,
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

## 7. Implementation Priority Order

### Phase 1: Core Harness (Week 1-2)
1. âœ… OAuth (GitHub, Google) - DONE
2. âœ… Basic auth flow - DONE
3. [ ] Create harness files (`feature_list.json`, `claude-progress.txt`, `init.sh`)
4. [ ] Set up Claude CLI in Codespaces
5. [ ] Implement `POST /api/ai/expand-brief` endpoint

### Phase 2: Create Project Flow (Week 2-3)
1. [ ] `CreateProject.jsx` - Convert HTML to React
2. [ ] `ProjectBrief.jsx` with AI expansion
3. [ ] `ConnectionSource.jsx` - GitHub OAuth in flow
4. [ ] `ProjectContext.jsx` - Generated context display
5. [ ] Database: `projects` table with context fields

### Phase 3: Agents & MCP (Week 3-4)
1. [ ] Database: `agents`, `mcp_servers` tables
2. [ ] `GET/POST /api/agents` endpoints
3. [ ] `GET/POST /api/mcp-servers` endpoints
4. [ ] `AgentSelector.jsx` component
5. [ ] `MCPSelector.jsx` component

### Phase 4: Workspace Enhancement (Week 4-5)
1. [ ] `PreviewPanel.jsx` - Codespaces preview
2. [ ] Multi-agent chat routing
3. [ ] Agent-specific tool access
4. [ ] MCP server connections

### Phase 5: Testing & Polish (Week 5-6)
1. [ ] Puppeteer/Playwright browser automation tests
2. [ ] Feature completion tracking
3. [ ] Session handoff verification
4. [ ] Documentation

---

## 8. Skills & MCP Integration

### Built-in Skills (from Anthropic's Skills framework)
```javascript
const builtinSkills = [
  {
    id: 'coding-react',
    name: 'React Development',
    description: 'Best practices for React component development',
    type: 'coding'
  },
  {
    id: 'coding-python',
    name: 'Python/FastAPI',
    description: 'Python backend development patterns',
    type: 'coding'
  },
  {
    id: 'writing-docs',
    name: 'Technical Documentation',
    description: 'Writing clear technical docs and READMEs',
    type: 'writing'
  }
];
```

### MCP Server Types to Support
```javascript
const mcpServerTypes = [
  { type: 'filesystem', name: 'File System', icon: 'ðŸ“' },
  { type: 'github', name: 'GitHub', icon: 'ðŸ™' },
  { type: 'postgres', name: 'PostgreSQL', icon: 'ðŸ˜' },
  { type: 'browser', name: 'Browser/Puppeteer', icon: 'ðŸŒ' },
  { type: 'memory', name: 'Memory/Context', icon: 'ðŸ§ ' },
  { type: 'search', name: 'Web Search', icon: 'ðŸ”' }
];
```

---

## 9. Claude CLI Commands for This Project

```bash
# Initialize the project harness
claude init --harness

# Start a coding session
claude code --project hubllm

# Run specific feature
claude code --feature "project-001"

# Review progress
claude status

# Generate tests for a feature
claude test --feature "auth-001"

# Commit session work
claude commit --message "Implemented Create Project flow"
```

---

## 10. Testing Strategy (Anthropic's Approach)

### Browser Automation (Required)
```javascript
// test/e2e/create-project.spec.js
import { test, expect } from '@playwright/test';

test('user can create project with AI brief', async ({ page }) => {
  await page.goto('/create-project');
  
  // Step 1: Enter brief
  await page.fill('#project-brief', 'Build a todo app with React');
  await page.click('text=Define Project with AI');
  
  // Wait for AI response
  await expect(page.locator('#ai-brief-chat')).toBeVisible();
  
  // Verify context was generated
  await expect(page.locator('#ctx-tech-stack')).not.toBeEmpty();
});
```

### Feature Verification
```javascript
// After each feature implementation, run:
// 1. Unit tests (Jest/Pytest)
// 2. Integration tests (API)
// 3. E2E tests (Playwright)
// 4. Update feature_list.json: passes: true
```

---

## Summary: What to Do Next

1. **Create harness files** in your repo root:
   - `feature_list.json` (expand with all features from mockup)
   - `claude-progress.txt` (start logging sessions)
   - `init.sh` (automate dev environment)

2. **Install Claude CLI** in your Codespace

3. **Map mockup to React** using the tables above

4. **Implement in priority order**:
   - Create Project flow first (highest value)
   - Then Agents/MCP
   - Then Workspace enhancements

5. **Test with browser automation** before marking features done

6. **Commit after each feature** with clear messages

The harness approach will keep Claude focused, prevent one-shotting, and ensure clean handoffs between coding sessions.
