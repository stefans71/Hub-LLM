<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HubLLM - UI Mockup v2</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0f1419;
      --bg-secondary: #1a2028;
      --bg-tertiary: #242b35;
      --border: #2d3748;
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --accent: #f97316;
      --success: #22c55e;
      --warning: #eab308;
      --error: #ef4444;
      --text-primary: #ffffff;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow: hidden;
    }

    /* ==================== LAYOUT ==================== */
    .app-container {
      display: flex;
      height: 100%;
      overflow: hidden;
    }

    .sidebar {
      width: 260px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      transition: width 0.2s ease;
      position: relative;
      height: 100%;
      overflow: hidden;
    }

    .sidebar.collapsed {
      width: 48px;
      overflow: hidden;
    }

    .sidebar.collapsed .sidebar-nav,
    .sidebar.collapsed .sidebar-footer {
      display: none;
    }

    .sidebar.collapsed .sidebar-header {
      padding: 12px;
    }

    .sidebar.collapsed .logo span,
    .sidebar.collapsed .logo-subtitle {
      display: none;
    }

    .sidebar-expand-btn {
      display: none;
      position: absolute;
      top: 145px; /* Same vertical position as Workspaces header */
      right: 8px;
      width: 24px;
      height: 24px;
      background: transparent;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      font-size: 12px;
      z-index: 10;
    }

    .sidebar-expand-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .sidebar.collapsed .sidebar-expand-btn {
      display: flex;
    }

    .sidebar-toggle-btn {
      width: 24px;
      height: 24px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 4px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-toggle-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 18px;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: var(--primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-subtitle {
      font-size: 11px;
      color: var(--text-secondary);
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 0 8px;
      margin-bottom: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      font-size: 14px;
      position: relative;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 0;
      background: var(--primary);
      border-radius: 0 2px 2px 0;
      transition: height 0.2s ease;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      transform: translateX(4px);
    }

    .nav-item:hover::before {
      height: 60%;
    }

    .nav-item.active {
      background: var(--primary);
      color: white;
      transform: translateX(0);
    }

    .nav-item.active::before {
      display: none;
    }

    .nav-item-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Workspace tree */
    .workspace-tree {
      margin-left: 8px;
    }

    .workspace-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 13px;
    }

    .workspace-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .workspace-item.expanded > .workspace-children {
      display: block;
    }

    .workspace-children {
      margin-left: 20px;
      border-left: 1px solid var(--border);
      padding-left: 8px;
    }

    .project-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 13px;
    }

    .project-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .project-item.active {
      background: rgba(59, 130, 246, 0.2);
      color: var(--primary);
    }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
    }

    .new-project-btn {
      width: 100%;
      padding: 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: background 0.15s;
    }

    .new-project-btn:hover {
      background: var(--primary-hover);
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      margin-top: 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .user-profile:hover {
      background: var(--bg-tertiary);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-size: 14px;
      font-weight: 500;
    }

    .user-plan {
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* ==================== MAIN CONTENT ==================== */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .top-bar {
      height: 60px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 24px;
      gap: 16px;
    }

    .search-bar {
      flex: 1;
      max-width: 480px;
      position: relative;
    }

    .search-bar input {
      width: 100%;
      padding: 10px 16px 10px 40px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
    }

    .search-bar input::placeholder {
      color: var(--text-muted);
    }

    .search-bar input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }

    .top-bar-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .top-bar-link {
      padding: 8px 12px;
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      border-radius: 6px;
    }

    .top-bar-link:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      border-radius: 8px;
      cursor: pointer;
    }

    .icon-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .page-content {
      flex: 1;
      overflow-y: auto;
      padding: 32px;
    }

    /* ==================== DASHBOARD ==================== */
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .breadcrumb a {
      color: var(--text-secondary);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      color: var(--primary);
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 32px;
    }

    .page-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .page-subtitle {
      color: var(--text-secondary);
      font-size: 16px;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      border: none;
      position: relative;
      overflow: hidden;
    }

    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }

    .btn:active::after {
      width: 200px;
      height: 200px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    /* Pulsing CTA button */
    .btn-pulse {
      animation: btnPulse 2s ease-in-out infinite;
    }

    @keyframes btnPulse {
      0%, 100% {
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
      }
      50% {
        box-shadow: 0 4px 20px rgba(59, 130, 246, 0.6), 0 0 0 4px rgba(59, 130, 246, 0.1);
      }
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
      border-color: var(--text-muted);
      transform: translateY(-1px);
    }

    .btn-secondary:active {
      transform: translateY(0);
    }

    /* Card hover effects */
    .settings-panel {
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .settings-panel:hover {
      border-color: var(--border);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    /* Connection option cards */
    .connection-option {
      transition: all 0.2s ease !important;
    }

    .connection-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    /* Stat cards hover */
    .stat-card {
      transition: all 0.2s ease;
    }

    .stat-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    /* Project cards hover */
    .project-card {
      transition: all 0.2s ease;
    }

    .project-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    /* Nav items hover enhancement */
    .nav-item {
      transition: all 0.15s ease;
    }

    .nav-item:hover {
      transform: translateX(4px);
    }

    /* Input focus effects */
    .model-select:focus,
    input:focus,
    textarea:focus {
      outline: none;
      border-color: var(--primary) !important;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }

    /* Link hover effects */
    a {
      transition: color 0.15s ease, opacity 0.15s ease;
    }

    a:hover {
      opacity: 0.85;
    }

    /* Avatar hover */
    .user-avatar {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .user-avatar:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* Icon buttons hover */
    .workspace-icon-btn {
      transition: all 0.15s ease;
    }

    .workspace-icon-btn:hover {
      transform: scale(1.1);
      background: var(--border) !important;
    }

    /* Tab hover effects */
    .nav-tab {
      transition: all 0.15s ease;
    }

    .nav-tab:hover:not(.active) {
      color: var(--text-primary);
      background: rgba(255, 255, 255, 0.05);
    }

    /* Shimmer effect for loading states */
    @keyframes shimmer {
      0% {
        background-position: -200% 0;
      }
      100% {
        background-position: 200% 0;
      }
    }

    .shimmer {
      background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--border) 50%, var(--bg-tertiary) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    /* Glow effect for success states */
    @keyframes successGlow {
      0%, 100% {
        box-shadow: 0 0 5px rgba(34, 197, 94, 0.3);
      }
      50% {
        box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
      }
    }

    .success-glow {
      animation: successGlow 2s ease-in-out infinite;
    }

    /* GitHub button hover effects */
    .github-signin-btn:hover {
      background: #2d333b !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.3) !important;
    }

    .github-signin-btn:active {
      transform: translateY(0);
    }

    .github-create-btn:hover {
      background: #16a34a !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(34, 197, 94, 0.5) !important;
    }

    .github-create-btn:active {
      transform: translateY(0);
    }

    /* Define Project with AI button */
    .define-ai-btn {
      transition: all 0.2s ease !important;
    }

    .define-ai-btn:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 20px rgba(217, 119, 87, 0.4) !important;
    }

    /* VPS card hover */
    #vps-card {
      transition: all 0.2s ease;
    }

    #vps-card:hover {
      border-color: var(--primary);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    /* Model selector hover */
    .model-selector {
      transition: all 0.2s ease;
    }

    .model-selector:hover {
      border-color: var(--primary);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .stat-icon.blue { background: rgba(59, 130, 246, 0.2); color: var(--primary); }
    .stat-icon.green { background: rgba(34, 197, 94, 0.2); color: var(--success); }
    .stat-icon.purple { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }

    .stat-badge {
      font-size: 12px;
      font-weight: 500;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .stat-badge.positive { background: rgba(34, 197, 94, 0.2); color: var(--success); }
    .stat-badge.neutral { background: var(--bg-tertiary); color: var(--text-secondary); }

    .stat-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-desc {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .view-toggle {
      display: flex;
      gap: 4px;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: 8px;
    }

    .view-toggle button {
      padding: 8px 12px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      border-radius: 6px;
      cursor: pointer;
    }

    .view-toggle button.active {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .project-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .project-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .project-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .project-card-workspace {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .project-card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .project-card-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 16px;
      line-height: 1.5;
    }

    .project-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .tag {
      padding: 4px 10px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tag.vps { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
    .tag.local { background: rgba(34, 197, 94, 0.2); color: var(--success); }
    .tag.github { background: rgba(59, 130, 246, 0.2); color: var(--primary); }

    .project-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .project-avatars {
      display: flex;
    }

    .project-avatars .avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 2px solid var(--bg-secondary);
      margin-left: -8px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .project-avatars .avatar:first-child {
      margin-left: 0;
    }

    .project-updated {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .project-updated .dot {
      width: 6px;
      height: 6px;
      background: var(--success);
      border-radius: 50%;
    }

    .new-project-card {
      background: transparent;
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s;
    }

    .new-project-card:hover {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.05);
    }

    .new-project-card-icon {
      width: 48px;
      height: 48px;
      background: var(--bg-tertiary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 12px;
    }

    .new-project-card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .new-project-card-desc {
      font-size: 13px;
      color: var(--text-secondary);
      text-align: center;
    }

    /* ==================== SETTINGS PAGE ==================== */
    .settings-layout {
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 32px;
      max-width: 1000px;
    }

    .settings-nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .settings-nav-item {
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .settings-nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .settings-nav-item.active {
      background: var(--primary);
      color: white;
    }

    .settings-subnav-item {
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 4px;
    }

    .settings-subnav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .settings-subnav-item.active {
      background: rgba(59, 130, 246, 0.2);
      color: var(--primary);
    }

    .settings-panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 32px;
    }

    .settings-section {
      margin-bottom: 32px;
      padding-bottom: 32px;
      border-bottom: 1px solid var(--border);
    }

    .settings-section:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .settings-section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .settings-section-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
    }

    .api-key-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .api-key-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .api-key-info {
      flex: 1;
    }

    .api-key-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .api-key-status {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .api-key-status.connected {
      color: var(--success);
    }

    .api-key-actions {
      display: flex;
      gap: 8px;
    }

    .model-select-group {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .model-select {
      flex: 1;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
    }

    /* ==================== WORKSPACE VIEW ==================== */
    .workspace-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: var(--bg-primary);
    }

    .workspace-top-bar {
      height: 50px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 16px;
      gap: 16px;
      flex-shrink: 0;
      position: relative;
      z-index: 100;
    }

    .workspace-top-bar.collapsed {
      height: 0;
      padding: 0;
      overflow: visible;
      border-bottom: none;
    }

    .workspace-top-bar.collapsed > *:not(.header-toggle-container) {
      display: none !important;
    }

    .workspace-top-bar.collapsed .header-toggle-container {
      display: block;
      position: absolute;
      top: 0;
      bottom: auto;
    }

    .header-toggle-container {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 101;
    }

    .workspace-top-bar.collapsed .header-toggle-container {
      bottom: -20px;
      top: auto;
    }

    .header-toggle {
      width: 40px;
      height: 20px;
      background: var(--primary);
      border: none;
      border-radius: 0 0 8px 8px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      flex-shrink: 0;
    }

    .header-toggle:hover {
      background: var(--primary-hover);
      color: white;
    }

    .workspace-project-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .workspace-project-name {
      font-weight: 600;
      font-size: 15px;
    }

    .workspace-location {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .workspace-location.vps { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
    .workspace-location.local { background: rgba(34, 197, 94, 0.2); color: var(--success); }
    .workspace-location.github { background: rgba(59, 130, 246, 0.2); color: var(--primary); }

    .workspace-main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .workspace-icon-bar {
      width: 48px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 12px 0;
      gap: 4px;
      flex-shrink: 0;
    }

    .workspace-icon-btn {
      width: 48px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      cursor: pointer;
      border-left: 2px solid transparent;
    }

    .workspace-icon-btn:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .workspace-icon-btn.active {
      color: var(--primary);
      border-left-color: var(--primary);
      background: rgba(59, 130, 246, 0.1);
    }

    /* File Explorer Sidebar */
    .file-explorer {
      width: 220px;
      min-width: 0;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      transition: width 0.2s ease;
      overflow: hidden;
    }

    .file-explorer-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .file-explorer-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    .file-explorer-actions {
      display: flex;
      gap: 4px;
    }

    .file-explorer-actions button {
      width: 24px;
      height: 24px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 4px;
      font-size: 12px;
    }

    .file-explorer-actions button:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .file-tree {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .file-tree-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .file-tree-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .file-tree-item.active {
      background: rgba(59, 130, 246, 0.2);
      color: var(--primary);
    }

    .file-tree-item.folder {
      color: var(--text-primary);
      cursor: pointer;
    }

    .file-tree-item.folder:hover {
      background: var(--bg-tertiary);
    }

    .file-tree-children {
      margin-left: 16px;
      padding-left: 8px;
      border-left: 1px solid var(--border);
    }

    .workspace-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .workspace-panels {
      display: flex;
      flex: 1;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .chat-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 300px;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .chat-message {
      margin-bottom: 24px;
    }

    .chat-message.assistant {
      display: flex;
      gap: 12px;
    }

    .chat-message.assistant .avatar {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
      border-radius: 8px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-message.assistant .avatar.claude-avatar {
      background: linear-gradient(135deg, #D97757 0%, #C4694A 100%);
      color: white;
    }

    .chat-message-content {
      flex: 1;
    }

    .chat-message-content p {
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .chat-code-block {
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin: 12px 0;
      overflow: hidden;
    }

    .chat-code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: var(--bg-secondary);
      font-size: 12px;
      color: var(--text-secondary);
    }

    .chat-code-content {
      padding: 16px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 13px;
      overflow-x: auto;
    }

    .chat-code-content .keyword { color: #c678dd; }
    .chat-code-content .const { color: #e5c07b; }
    .chat-code-content .string { color: #98c379; }
    .chat-code-content .tag { color: #e06c75; }
    .chat-code-content .attr { color: #d19a66; }

    .chat-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 12px;
    }

    .chat-status .spinner {
      width: 14px;
      height: 14px;
      border: 2px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .chat-status a {
      color: var(--primary);
      text-decoration: none;
    }

    .chat-message.user {
      display: flex;
      justify-content: flex-end;
    }

    .chat-message.user .bubble {
      background: var(--primary);
      color: white;
      padding: 12px 16px;
      border-radius: 16px 16px 4px 16px;
      max-width: 70%;
    }

    .chat-input-area {
      padding: 16px 24px 24px;
      border-top: 1px solid var(--border);
    }

    .chat-input-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 4px 4px 4px 16px;
    }

    .chat-input-wrapper .plus-btn {
      color: var(--text-secondary);
      cursor: pointer;
    }

    .chat-input-wrapper input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 14px;
      padding: 12px 0;
    }

    .chat-input-wrapper input::placeholder {
      color: var(--text-muted);
    }

    .chat-input-wrapper input:focus {
      outline: none;
    }

    .mic-btn {
      width: 40px;
      height: 40px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-size: 18px;
    }

    .mic-btn:hover {
      background: var(--bg-secondary);
      color: var(--primary);
    }

    .mic-btn.recording {
      color: var(--error);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .chat-input-wrapper .send-btn {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-input-hint {
      text-align: center;
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    .preview-panel {
      flex: 1;
      min-width: 200px;
      display: flex;
      flex-direction: column;
      background: var(--bg-secondary);
      position: relative;
      overflow: hidden;
    }

    .preview-panel.collapsed {
      width: 60px !important;
      min-width: 60px !important;
      max-width: 60px !important;
      flex: none !important;
    }

    .preview-device-icons {
      display: flex;
      align-items: center;
      gap: 4px;
      padding-right: 8px;
      border-right: 1px solid var(--border);
      margin-right: 8px;
    }

    .device-btn {
      padding: 4px 8px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
    }

    .device-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .device-btn.active {
      background: var(--primary);
      color: white;
    }

    .preview-frame-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 16px;
      overflow: auto;
      background: var(--bg-tertiary);
    }

    .preview-frame {
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #1a1a1a;
      min-height: 400px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      flex-shrink: 0;
      width: 100%;
    }

    .preview-frame.phone {
      width: 375px;
      min-width: 375px;
      max-width: 375px;
    }

    .preview-frame.tablet {
      width: 768px;
      min-width: 768px;
      max-width: 768px;
    }

    .preview-frame.desktop {
      width: 1280px;
      min-width: 1280px;
      max-width: 1280px;
    }

    .preview-panel.collapsed .preview-toolbar,
    .preview-panel.collapsed .preview-frame-container {
      display: none;
    }

    .preview-panel.collapsed .preview-collapsed-bar {
      display: flex;
    }

    .preview-collapsed-bar {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      padding: 16px 8px;
      gap: 8px;
    }

    .preview-collapsed-bar span {
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .preview-toggle {
      position: absolute;
      left: -12px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 48px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-right: none;
      border-radius: 8px 0 0 8px;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      z-index: 10;
    }

    .preview-toggle:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .preview-toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-bottom: 1px solid var(--border);
    }

    .preview-dots {
      display: flex;
      gap: 6px;
    }

    .preview-dots span {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .preview-dots span:nth-child(1) { background: #ef4444; }
    .preview-dots span:nth-child(2) { background: #eab308; }
    .preview-dots span:nth-child(3) { background: #22c55e; }

    .preview-url {
      flex: 1;
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .preview-actions {
      display: flex;
      gap: 4px;
    }

    .preview-actions button {
      padding: 6px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 4px;
    }

    .preview-actions button:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .preview-demo {
      text-align: center;
      padding: 40px;
    }

    .preview-demo-logo {
      width: 48px;
      height: 48px;
      background: var(--primary);
      border-radius: 8px;
      margin: 0 auto 24px;
    }

    .preview-demo h1 {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .preview-demo h1 span {
      background: linear-gradient(90deg, var(--primary), #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .preview-demo p {
      color: #666;
      max-width: 400px;
      margin: 0 auto 24px;
      line-height: 1.6;
    }

    .preview-demo-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .preview-demo-buttons button {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
    }

    .preview-demo-buttons .primary {
      background: var(--primary);
      color: white;
      border: none;
    }

    .preview-demo-buttons .secondary {
      background: white;
      color: #333;
      border: 1px solid #ddd;
    }

    /* LLM Dev Panel - VS Code Style */
    .llm-dev-panel {
      border-top: 3px solid var(--accent);
      background: var(--bg-secondary);
      display: flex;
      flex-direction: column;
      min-height: 40px;
    }

    .llm-dev-header {
      display: flex;
      align-items: center;
      padding: 0 16px;
      height: 36px;
      cursor: ns-resize;
      user-select: none;
      flex-shrink: 0;
    }

    .llm-dev-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--accent);
      cursor: pointer;
    }

    .llm-dev-tabs {
      display: flex;
      gap: 4px;
      margin-left: 24px;
    }

    .llm-dev-tabs button {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      border-radius: 4px 4px 0 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .llm-dev-tabs button:hover {
      color: var(--text-primary);
    }

    .llm-dev-tabs button.active {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .llm-dev-status {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .llm-dev-status .server {
      color: var(--success);
    }

    .llm-dev-content {
      flex: 1;
      display: flex;
      background: var(--bg-primary);
      overflow: hidden;
      min-height: 0;
    }

    .dev-file-explorer {
      width: 220px;
      min-width: 150px;
      max-width: 400px;
      border-right: none;
      display: flex;
      flex-direction: column;
      background: var(--bg-secondary);
      overflow-y: auto;
      flex-shrink: 0;
    }

    .dev-file-explorer-header {
      padding: 8px 12px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
    }

    .dev-file-explorer-header button:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .dev-file-tree {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .dev-file-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-secondary);
      font-family: 'Monaco', 'Consolas', monospace;
    }

    .dev-file-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .dev-file-item.active {
      background: rgba(59, 130, 246, 0.2);
      color: var(--primary);
    }

    .dev-file-item.folder {
      color: var(--text-primary);
    }

    .dev-file-children {
      margin-left: 16px;
    }

    .dev-file-children {
      margin-left: 12px;
    }

    .dev-editor-area {
      flex: 1;
      min-width: 200px;
      display: flex;
      flex-direction: column;
    }

    .dev-editor-tabs {
      display: flex;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
    }

    .dev-editor-tab {
      padding: 8px 16px;
      font-size: 12px;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      border-right: 1px solid var(--border);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dev-editor-tab:hover {
      background: var(--bg-tertiary);
    }

    .dev-editor-tab.active {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .dev-editor-tab .close {
      opacity: 0;
      font-size: 10px;
    }

    .dev-editor-tab:hover .close {
      opacity: 1;
    }

    .dev-editor-content {
      flex: 1;
      padding: 16px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 13px;
      overflow: auto;
      line-height: 1.5;
    }

    .dev-editor-content .line-number {
      color: var(--text-muted);
      margin-right: 16px;
      user-select: none;
    }

    .dev-terminal-area {
      width: 35%;
      min-width: 200px;
      border-left: none;
      display: flex;
      flex-direction: column;
    }

    .dev-terminal-tabs {
      display: flex;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 0 8px;
    }

    .dev-terminal-tab {
      padding: 8px 12px;
      font-size: 12px;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .dev-terminal-tab:hover {
      color: var(--text-primary);
    }

    .dev-terminal-tab.active {
      color: var(--text-primary);
      border-bottom: 2px solid var(--primary);
    }

    .dev-terminal-content {
      flex: 1;
      padding: 12px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 12px;
      overflow-y: auto;
    }

    .terminal-line {
      margin-bottom: 4px;
    }

    .terminal-line .prompt {
      color: var(--success);
    }

    .terminal-line .command {
      color: var(--text-primary);
    }

    .terminal-line .output {
      color: var(--text-secondary);
    }

    .terminal-line .success {
      color: var(--success);
    }

    .terminal-line .error {
      color: var(--error);
    }

    /* Connection status */
    .connection-status {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
    }

    .connection-status.connected {
      background: rgba(34, 197, 94, 0.15);
      color: var(--success);
    }

    .connection-status.disconnected {
      background: rgba(239, 68, 68, 0.15);
      color: var(--error);
    }

    .connection-status::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
    }

    .model-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      position: relative;
    }

    .model-selector-icon {
      width: 20px;
      height: 20px;
      background: var(--error);
      border-radius: 4px;
    }

    .model-selector-name {
      font-size: 13px;
      font-weight: 500;
    }

    .model-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      min-width: 220px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-top: 4px;
      padding: 8px 0;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .model-dropdown.open {
      display: block;
    }

    .model-dropdown-section {
      padding: 8px 12px 4px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .model-dropdown-item {
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.15s ease;
      border-left: 2px solid transparent;
    }

    .model-dropdown-item:hover {
      background: var(--bg-tertiary);
      border-left-color: var(--primary);
      padding-left: 14px;
    }

    .model-dropdown-item.active {
      color: var(--primary);
      border-left-color: var(--primary);
    }

    .model-dropdown-item.disabled {
      color: var(--text-muted);
      cursor: not-allowed;
    }

    .model-dropdown-item.disabled:hover {
      background: transparent;
      border-left-color: transparent;
      padding-left: 12px;
    }

    .model-dropdown-item.paid {
      color: var(--text-secondary);
    }

    .model-dropdown-item.paid:hover {
      background: var(--bg-tertiary);
    }

    /* Model Selection Notification */
    .model-notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      width: 400px;
      max-width: 90vw;
      z-index: 2000;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      display: none;
    }

    .model-notification.show {
      display: block;
    }

    .model-notification-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 1999;
      display: none;
    }

    .model-notification-overlay.show {
      display: block;
    }

    .model-notification-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .model-notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .model-notification-title {
      font-size: 16px;
      font-weight: 600;
    }

    .model-notification-body {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .model-notification-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .model-notification-choice {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .model-choice-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
    }

    .model-choice-option:hover {
      border-color: var(--primary);
    }

    .model-choice-option.selected {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.1);
    }

    .model-choice-radio {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .model-choice-option.selected .model-choice-radio {
      border-color: var(--primary);
    }

    .model-choice-option.selected .model-choice-radio::after {
      content: '';
      width: 10px;
      height: 10px;
      background: var(--primary);
      border-radius: 50%;
    }

    .export-btn {
      padding: 8px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-left: auto;
    }

    .export-btn:hover {
      background: var(--border);
    }

    /* ==================== MODAL STYLES ==================== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 2000;
      display: none;
    }

    .modal-overlay.show {
      display: block;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      width: 90%;
      max-width: 560px;
      max-height: 90vh;
      display: none;
      flex-direction: column;
      z-index: 2001;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }

    .modal.show {
      display: flex;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }

    .modal-header h3 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .modal-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .modal-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 16px 24px;
      border-top: 1px solid var(--border);
    }

    /* ==================== VIEW SWITCHING ==================== */
    .view {
      display: none;
      height: calc(100vh - 44px);
      margin-top: 44px;
      overflow: hidden;
    }

    .view.active {
      display: block;
    }

    .view-workspace.active {
      display: flex;
    }

    /* Navigation state */
    .nav-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }

    .nav-tab {
      padding: 6px 12px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      border-radius: 4px;
    }

    .nav-tab:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-tab.active {
      background: var(--primary);
      color: white;
    }

    /* Resizer */
    .resizer {
      height: 4px;
      background: var(--border);
      cursor: ns-resize;
    }

    .resizer:hover {
      background: var(--primary);
    }

    .resizer-vertical {
      width: 4px;
      background: var(--border);
      cursor: ew-resize;
      flex-shrink: 0;
    }

    .resizer-vertical:hover {
      background: var(--primary);
    }
  </style>
</head>
<body>

  <!-- ==================== NAVIGATION TABS ==================== -->
  <div style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: var(--bg-primary); padding: 6px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 16px;">
    <!-- Logo -->
    <div style="display: flex; align-items: center; gap: 8px;">
      <div style="width: 24px; height: 24px; background: var(--primary); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px;"></div>
      <span style="font-weight: 600; font-size: 14px;">HubLLM.dev</span>
    </div>
    <div class="nav-tabs" style="margin: 0; border: none; padding: 0;">
      <button class="nav-tab active" onclick="showView('dashboard')">Dashboard</button>
      <button class="nav-tab" onclick="showView('workspace')">Workspace</button>
      <button class="nav-tab" onclick="showView('settings')">Settings</button>
      <button class="nav-tab" onclick="showView('create-project')">Create Project</button>
    </div>
  </div>

  <!-- ==================== DASHBOARD VIEW ==================== -->
  <div id="view-dashboard" class="view active">
    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="dashboard-sidebar">
        <!-- Expand button (shown when collapsed) -->
        <button class="sidebar-expand-btn" onclick="toggleDashboardSidebar()" title="Expand Sidebar"></button>
        <nav class="sidebar-nav" style="padding-top: 16px;">
          <div class="nav-section">
            <div class="nav-section-title">Main</div>
            <div class="nav-item active">
              <div class="nav-item-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
              </div>
              Dashboard
            </div>
            <div class="nav-item" onclick="showView('settings')">
              <div class="nav-item-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
              </div>
              Settings
            </div>
          </div>

          <div class="nav-section">
            <div class="nav-section-title" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Workspaces</span>
              <div style="display: flex; align-items: center; gap: 4px;">
                <button onclick="event.stopPropagation(); showView('create-project')" style="background: var(--primary); border: none; border-radius: 4px; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; cursor: pointer;" title="Create Project">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                </button>
                <button onclick="toggleDashboardSidebar()" id="dashboard-sidebar-toggle" class="sidebar-toggle-btn" title="Collapse Sidebar"></button>
              </div>
            </div>
            
            <!-- Customers Workspace -->
            <div class="workspace-item" onclick="toggleWorkspace(this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0;">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
              </svg>
              <span>Customers</span>
              <span style="margin-left: auto; font-size: 10px;"></span>
            </div>
            <div class="workspace-children">
              <div class="project-item" onclick="showView('workspace')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; opacity: 0.6;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                Acme Corp Website
              </div>
              <div class="project-item active" onclick="showView('workspace')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; opacity: 0.7;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                API Backend Optimization
              </div>
              <div class="project-item" onclick="showView('workspace')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; opacity: 0.7;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                Beta Inc Dashboard
              </div>
            </div>

            <!-- Personal Workspace -->
            <div class="workspace-item" onclick="toggleWorkspace(this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0;">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
              </svg>
              <span>Personal</span>
              <span style="margin-left: auto; font-size: 10px;"></span>
            </div>

            <!-- Archives -->
            <div class="workspace-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; opacity: 0.6;">
                <polyline points="21 8 21 21 3 21 3 8"></polyline>
                <rect x="1" y="3" width="22" height="5"></rect>
                <line x1="10" y1="12" x2="14" y2="12"></line>
              </svg>
              <span>Archives</span>
            </div>
          </div>
        </nav>

        <div class="sidebar-footer">
          <button class="new-project-btn" onclick="showView('create-project')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New Project
          </button>
          <div class="user-profile" onclick="showView('settings')">
            <div class="user-avatar">AE</div>
            <div class="user-info">
              <div class="user-name">Alex Engineer</div>
              <div class="user-plan">Pro Account</div>
            </div>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.5;">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <header class="top-bar">
          <div class="search-bar">
            <span class="search-icon"></span>
            <input type="text" placeholder="Search projects, repos, or LLM outputs...">
          </div>
          <div class="top-bar-actions">
            <span class="top-bar-link">Docs</span>
            <span class="top-bar-link">Community</span>
            <button class="icon-btn"></button>
            <button class="icon-btn"></button>
          </div>
        </header>

        <div class="page-content">
          <div class="breadcrumb">
            <a href="#">Home</a>
            <span></span>
            <span>Projects</span>
          </div>

          <div class="page-header">
            <div>
              <h1 class="page-title">Project Dashboard</h1>
              <p class="page-subtitle">Manage your LLM-connected workspaces and projects with ease.</p>
            </div>
            <div class="header-actions">
              <button class="btn btn-secondary" style="display: flex; align-items: center; gap: 6px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="23 4 23 10 17 10"></polyline>
                  <polyline points="1 20 1 14 7 14"></polyline>
                  <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                Refresh All
              </button>
              <button class="btn btn-primary" onclick="showView('create-project')" style="display: flex; align-items: center; gap: 6px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Create Project
              </button>
            </div>
          </div>

          <!-- Stats -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon blue" style="display: flex; align-items: center; justify-content: center;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                  </svg>
                </div>
                <span class="stat-badge positive">+20%</span>
              </div>
              <div class="stat-label">Active Sessions</div>
              <div class="stat-value">12</div>
              <div class="stat-desc">Across 4 LLM providers</div>
            </div>
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon green" style="display: flex; align-items: center; justify-content: center;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                </div>
                <span class="stat-badge positive">+5%</span>
              </div>
              <div class="stat-label">Total Projects</div>
              <div class="stat-value">48</div>
              <div class="stat-desc">12 GitHub, 36 Local</div>
            </div>
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon purple" style="display: flex; align-items: center; justify-content: center;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                  </svg>
                </div>
                <span class="stat-badge neutral">Stable</span>
              </div>
              <div class="stat-label">Connected LLMs</div>
              <div class="stat-value">5</div>
              <div class="stat-desc">OpenRouter + Anthropic</div>
            </div>
          </div>

          <!-- Active Workspaces -->
          <div class="section-header">
            <h2 class="section-title" style="display: flex; align-items: center; gap: 8px;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
              </svg>
              Recent Projects
            </h2>
            <div class="view-toggle">
              <button class="active">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
              </button>
              <button>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="3" y1="6" x2="21" y2="6"></line>
                  <line x1="3" y1="12" x2="21" y2="12"></line>
                  <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>

          <div class="projects-grid">
            <div class="project-card" onclick="showView('workspace')">
              <div class="project-card-workspace">Customers</div>
              <div class="project-card-header">
                <div class="project-card-title">API Backend Optimization</div>
                <button class="icon-btn" style="width: 32px; height: 32px;"></button>
              </div>
              <p class="project-card-desc">Refactoring Node.js endpoints using Claude-3 Opus for performance gains.</p>
              <div class="project-tags">
                <span class="tag vps" style="display: inline-flex; align-items: center; gap: 4px;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
                    <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
                    <line x1="6" y1="6" x2="6.01" y2="6"></line>
                    <line x1="6" y1="18" x2="6.01" y2="18"></line>
                  </svg>
                  VPS: prod-01
                </span>
                <span class="tag" style="display: inline-flex; align-items: center; gap: 4px;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="18" cy="18" r="3"></circle>
                    <circle cx="6" cy="6" r="3"></circle>
                    <path d="M6 21V9a9 9 0 0 0 9 9"></path>
                  </svg>
                  Node.js
                </span>
              </div>
              <div class="project-card-footer">
                <div class="project-avatars">
                  <div class="avatar" style="background: #22c55e;">G</div>
                  <div class="avatar" style="background: #3b82f6;">C</div>
                </div>
                <div class="project-updated">
                  <span class="dot"></span>
                  Updated 2m ago
                </div>
              </div>
            </div>

            <div class="project-card" onclick="showView('workspace')">
              <div class="project-card-workspace">Customers</div>
              <div class="project-card-header">
                <div class="project-card-title">Frontend UI Kit</div>
                <button class="icon-btn" style="width: 32px; height: 32px;"></button>
              </div>
              <p class="project-card-desc">Automated component generation from Figma designs using GPT-4...</p>
              <div class="project-tags">
                <span class="tag local"> Local</span>
                <span class="tag"> React + Tailwind</span>
              </div>
              <div class="project-card-footer">
                <div class="project-avatars">
                  <div class="avatar" style="background: #8b5cf6;">G</div>
                </div>
                <div class="project-updated">
                  Updated 4h ago
                </div>
              </div>
            </div>

            <div class="project-card" onclick="showView('workspace')">
              <div class="project-card-workspace">Personal</div>
              <div class="project-card-header">
                <div class="project-card-title">Portfolio Website</div>
                <button class="icon-btn" style="width: 32px; height: 32px;"></button>
              </div>
              <p class="project-card-desc">Personal portfolio site with blog integration and dark mode.</p>
              <div class="project-tags">
                <span class="tag github"> GitHub: portfolio</span>
                <span class="tag"> Next.js</span>
              </div>
              <div class="project-card-footer">
                <div class="project-avatars">
                  <div class="avatar" style="background: #f97316;">A</div>
                </div>
                <div class="project-updated">
                  Updated 1d ago
                </div>
              </div>
            </div>

            <div class="new-project-card" onclick="showView('create-project')">
              <div class="new-project-card-icon"></div>
              <div class="new-project-card-title">Start New Project</div>
              <div class="new-project-card-desc">Connect to a VPS, local folder, or GitHub repo.</div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- ==================== SETTINGS VIEW ==================== -->
  <div id="view-settings" class="view">
    <div class="app-container">
      <!-- Sidebar with Settings sub-items -->
      <aside class="sidebar">
        <nav class="sidebar-nav" style="padding-top: 16px;">
          <div class="nav-section">
            <div class="nav-section-title">Main</div>
            <div class="nav-item" onclick="showView('dashboard')">
              <div class="nav-item-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
              </div>
              Dashboard
            </div>
          </div>
          
          <!-- Settings with sub-items -->
          <div class="nav-section">
            <div class="nav-section-title">Settings</div>
            
            <div style="font-size: 10px; text-transform: uppercase; color: var(--text-muted); padding: 8px 12px 4px 12px; margin-top: 4px;">Account</div>
            <div class="settings-subnav-item active" onclick="showSettingsTab('subscription')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.7;">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              Anthropic Subscription
            </div>
            <div class="settings-subnav-item" onclick="showSettingsTab('apikeys')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.7;">
                <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
              </svg>
              API Keys
            </div>
            <div class="settings-subnav-item" onclick="showSettingsTab('profile')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.7;">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              Profile
            </div>
            <div class="settings-subnav-item" onclick="showSettingsTab('appearance')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.7;">
                <circle cx="13.5" cy="6.5" r=".5"></circle>
                <circle cx="17.5" cy="10.5" r=".5"></circle>
                <circle cx="8.5" cy="7.5" r=".5"></circle>
                <circle cx="6.5" cy="12.5" r=".5"></circle>
                <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"></path>
              </svg>
              Appearance
            </div>
            
            <div style="font-size: 10px; text-transform: uppercase; color: var(--text-muted); padding: 8px 12px 4px 12px; margin-top: 8px; border-top: 1px solid var(--border); padding-top: 12px;">Global Defaults</div>
            <div class="settings-subnav-item" onclick="showSettingsTab('globalagents')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.7;">
                <rect x="3" y="11" width="18" height="10" rx="2"></rect>
                <circle cx="12" cy="5" r="2"></circle>
                <path d="M12 7v4"></path>
                <line x1="8" y1="16" x2="8" y2="16"></line>
                <line x1="16" y1="16" x2="16" y2="16"></line>
              </svg>
              Agents
            </div>
            <div class="settings-subnav-item" onclick="showSettingsTab('globalskills')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.7;">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
              </svg>
              Skills
            </div>
            <div class="settings-subnav-item" onclick="showSettingsTab('globalmcp')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.7;">
                <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
                <path d="M12 6v6l4 2"></path>
              </svg>
              MCP Servers
            </div>
          </div>
        </nav>
        <div class="sidebar-footer">
          <button class="new-project-btn" onclick="showView('create-project')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New Project
          </button>
          <div class="user-profile">
            <div class="user-avatar">AE</div>
            <div class="user-info">
              <div class="user-name">Alex Engineer</div>
              <div class="user-plan">Pro Account</div>
            </div>
          </div>
        </div>
      </aside>

      <main class="main-content">
        <header class="top-bar">
          <div class="search-bar">
            <span class="search-icon"></span>
            <input type="text" placeholder="Search settings...">
          </div>
        </header>

        <div class="page-content">
          <!-- Settings content now takes full width -->
          <div class="settings-panel" style="max-width: 900px;">
              <!-- Anthropic Subscription Section -->
              <div class="settings-section" id="settings-subscription">
                <h2 class="settings-section-title">Anthropic Subscription</h2>
                <p class="settings-section-desc">Connect your Anthropic account to access Claude Code CLI and authenticate with your subscription.</p>

                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 24px; margin-top: 16px;">
                  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                    <div style="width: 48px; height: 48px; background: rgba(239, 68, 68, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;"></div>
                    <div>
                      <div style="font-weight: 600; font-size: 16px;">Claude Code CLI</div>
                      <div style="font-size: 13px; color: var(--text-secondary);">Command-line access to Claude for development workflows</div>
                    </div>
                  </div>
                  
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <div style="width: 12px; height: 12px; background: var(--success); border-radius: 50%;"></div>
                      <div>
                        <div style="font-weight: 500;">Connected</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Authenticated as alex@example.com</div>
                      </div>
                      <button class="btn btn-secondary" style="margin-left: auto; padding: 6px 12px; font-size: 12px;">Disconnect</button>
                    </div>
                  </div>

                  <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">
                    <strong>CLI Status:</strong> Installed (v1.2.3) &nbsp;|&nbsp; <strong>Default Model:</strong> Claude Opus 4.5
                  </div>

                  <div style="display: flex; gap: 12px;">
                    <button class="btn btn-primary" style="padding: 10px 20px;">
                       Re-authenticate
                    </button>
                    <button class="btn btn-secondary" style="padding: 10px 20px;">
                       Reinstall CLI
                    </button>
                  </div>
                </div>

                <!-- Cross-LLM Requests Section -->
                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 24px; margin-top: 20px; border: 1px solid var(--border);">
                  <div style="display: flex; align-items: flex-start; gap: 16px;">
                    <div style="display: flex; align-items: center; justify-content: center; padding-top: 4px;">
                      <input type="checkbox" id="cross-llm-checkbox" style="width: 20px; height: 20px; cursor: pointer;" onchange="toggleCrossLLM()">
                    </div>
                    <div style="flex: 1;">
                      <label for="cross-llm-checkbox" style="font-weight: 600; font-size: 15px; cursor: pointer; display: block;">Enable Cross-LLM Requests via OpenRouter</label>
                      <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">
                        Allow Claude CLI to call other LLMs (GPT, Gemini, etc.) through OpenRouter when you ask it to. 
                        For example: <code style="background: var(--bg-secondary); padding: 2px 6px; border-radius: 4px; font-size: 12px;">"Ask GPT-5.2-Codex to review this file"</code>
                      </div>
                    </div>
                  </div>

                  <div id="cross-llm-options" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                      <div style="width: 10px; height: 10px; background: var(--warning); border-radius: 50%;"></div>
                      <span style="font-size: 13px; color: var(--text-secondary);">Requires OpenRouter API key in API Keys settings</span>
                    </div>
                    
                    <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                      <div style="font-weight: 500; margin-bottom: 8px;"> Cross-LLM Bridge Script</div>
                      <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                        This script enables Claude CLI to route requests to other models via OpenRouter. Once installed, you can ask Claude to consult other AI models during your coding sessions.
                      </div>
                      <div style="display: flex; gap: 12px; align-items: center;">
                        <button class="btn btn-primary" style="padding: 10px 20px;" onclick="alert('Installing cross-LLM bridge script...')">
                           Install Bridge Script
                        </button>
                        <span style="font-size: 12px; color: var(--text-muted);">Status: Not installed</span>
                      </div>
                    </div>

                    <div style="font-size: 12px; color: var(--text-muted); padding: 12px; background: rgba(234, 179, 8, 0.1); border-radius: 8px; border-left: 3px solid var(--warning);">
                      <strong> Usage:</strong> After installing, you can say things like:<br>
                       "Ask GPT-5.2-Codex to review this function"<br>
                       "Have Gemini Pro analyze this architecture"<br>
                       "Get a second opinion from GPT-4o on this approach"
                    </div>
                  </div>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid var(--primary);">
                  <div style="font-size: 13px; color: var(--text-secondary);">
                    <strong>Note:</strong> Your Anthropic subscription provides unlimited access to Claude models. Using other LLMs via OpenRouter is a paid feature and will use your OpenRouter credits.
                  </div>
                </div>
              </div>

              <!-- API Keys Section -->
              <div class="settings-section" id="settings-apikeys" style="display: none;">
                <h2 class="settings-section-title">API Keys</h2>
                <p class="settings-section-desc">Connect your API keys to access different LLM providers. Keys are stored securely and never shared.</p>

                <div class="api-key-item">
                  <div class="api-key-icon" style="background: rgba(249, 115, 22, 0.2);"></div>
                  <div class="api-key-info">
                    <div class="api-key-name">OpenRouter</div>
                    <div class="api-key-status connected"> Connected - sk-or-v1-****7x9f</div>
                  </div>
                  <div class="api-key-actions">
                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Edit</button>
                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                  </div>
                </div>

                <div class="api-key-item" style="opacity: 0.6;">
                  <div class="api-key-icon" style="background: rgba(239, 68, 68, 0.2);"></div>
                  <div class="api-key-info">
                    <div class="api-key-name">Anthropic (Claude)</div>
                    <div class="api-key-status" style="color: var(--warning);"> Coming Soon</div>
                  </div>
                  <div class="api-key-actions">
                    <span style="font-size: 12px; color: var(--text-muted);">Use Subscription instead</span>
                  </div>
                </div>

                <div class="api-key-item" style="opacity: 0.6;">
                  <div class="api-key-icon" style="background: rgba(59, 130, 246, 0.2);"></div>
                  <div class="api-key-info">
                    <div class="api-key-name">Google (Gemini)</div>
                    <div class="api-key-status" style="color: var(--warning);"> Coming Soon</div>
                  </div>
                  <div class="api-key-actions">
                    <span style="font-size: 12px; color: var(--text-muted);">In development</span>
                  </div>
                </div>

                <button class="btn btn-secondary" style="margin-top: 16px;">
                   Add Another Provider
                </button>
              </div>

              <!-- Default Model Section -->
              <div class="settings-section" id="settings-model" style="display: none;">
                <h2 class="settings-section-title">Default Model</h2>
                <p class="settings-section-desc">Choose the default AI model for new projects. Your Anthropic subscription provides access to all Claude models. Other models require OpenRouter.</p>

                <div class="model-select-group">
                  <select class="model-select">
                    <optgroup label="Anthropic (Subscription - Included)">
                      <option selected>Claude Opus 4.5</option>
                      <option>Claude Sonnet 4.5</option>
                      <option>Claude 3.5 Sonnet</option>
                      <option>Claude 3 Opus</option>
                      <option>Claude 3 Haiku</option>
                    </optgroup>
                    <optgroup label="OpenRouter (Paid - Requires API Key)">
                      <option>GPT-4o</option>
                      <option>GPT-4 Turbo</option>
                      <option>GPT-5.2 Codex</option>
                    </optgroup>
                    <optgroup label="Google (Coming Soon)">
                      <option disabled>Gemini Pro  Coming Soon</option>
                    </optgroup>
                  </select>
                  <button class="btn btn-primary">Save</button>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(234, 179, 8, 0.1); border-radius: 8px; border-left: 3px solid var(--warning);">
                  <div style="font-size: 13px; color: var(--text-secondary);">
                    <strong> Tip:</strong> Claude models are free with your Anthropic subscription. OpenRouter models use your API credits and are billed separately.
                  </div>
                </div>
              </div>

              <!-- VPS Connections Section -->
              <div class="settings-section" id="settings-vps" style="display: none;">
                <h2 class="settings-section-title">VPS Connections</h2>
                <p class="settings-section-desc">Manage your VPS and remote server connections.</p>
                
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                  <div style="font-size: 48px; margin-bottom: 16px;"></div>
                  <p>Configure VPS connections in Create Project</p>
                  <button class="btn btn-primary" style="margin-top: 16px;" onclick="showView('create-project')">Add VPS Connection</button>
                </div>
              </div>

              <!-- Profile Section -->
              <div class="settings-section" id="settings-profile" style="display: none;">
                <h2 class="settings-section-title">Profile</h2>
                <p class="settings-section-desc">Manage your profile information and preferences.</p>

                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 24px; margin-top: 16px;">
                  <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px;">
                    <div style="width: 80px; height: 80px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 600; color: white;">AE</div>
                    <div>
                      <div style="font-size: 20px; font-weight: 600;">Alex Engineer</div>
                      <div style="color: var(--text-secondary);">alex@example.com</div>
                      <div style="margin-top: 8px;"><span style="background: var(--primary); color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 500;">PRO ACCOUNT</span></div>
                    </div>
                    <button class="btn btn-secondary" style="margin-left: auto;">Change Photo</button>
                  </div>

                  <div style="display: grid; gap: 16px;">
                    <div>
                      <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px;">Display Name</label>
                      <input type="text" value="Alex Engineer" style="width: 100%; padding: 10px 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                    </div>
                    
                    <div>
                      <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px;">AI Assistant Alias</label>
                      <input type="text" value="Claude" placeholder="e.g., Claude, Cortana, Jarvis..." style="width: 100%; padding: 10px 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                      <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">What should the AI call itself when responding?</div>
                    </div>

                    <div>
                      <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px;">Email</label>
                      <input type="email" value="alex@example.com" style="width: 100%; padding: 10px 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                    </div>

                    <div>
                      <label style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px;">Timezone</label>
                      <select style="width: 100%; padding: 10px 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                        <option>America/Los_Angeles (PST)</option>
                        <option>America/New_York (EST)</option>
                        <option>Europe/London (GMT)</option>
                        <option>Asia/Tokyo (JST)</option>
                      </select>
                    </div>
                  </div>

                  <button class="btn btn-primary" style="margin-top: 20px;">Save Profile</button>
                </div>
              </div>

              <!-- Appearance Section -->
              <div class="settings-section" id="settings-appearance" style="display: none;">
                <h2 class="settings-section-title">Appearance</h2>
                <p class="settings-section-desc">Customize the look and feel of HubLLM.</p>

                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 24px; margin-top: 16px;">
                  <div style="margin-bottom: 24px;">
                    <div style="font-weight: 500; margin-bottom: 12px;">Theme</div>
                    <div style="display: flex; gap: 12px;">
                      <div style="flex: 1; padding: 20px; background: #1a1a2e; border: 2px solid var(--primary); border-radius: 12px; cursor: pointer; text-align: center;">
                        <div style="font-size: 24px; margin-bottom: 8px;"></div>
                        <div style="font-weight: 500;">Dark Mode</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Active</div>
                      </div>
                      <div style="flex: 1; padding: 20px; background: #f5f5f5; border: 2px solid var(--border); border-radius: 12px; cursor: pointer; text-align: center; color: #333;">
                        <div style="font-size: 24px; margin-bottom: 8px;"></div>
                        <div style="font-weight: 500;">Light Mode</div>
                        <div style="font-size: 12px; color: #666;">Click to activate</div>
                      </div>
                      <div style="flex: 1; padding: 20px; background: linear-gradient(135deg, #1a1a2e 50%, #f5f5f5 50%); border: 2px solid var(--border); border-radius: 12px; cursor: pointer; text-align: center;">
                        <div style="font-size: 24px; margin-bottom: 8px;"></div>
                        <div style="font-weight: 500;">System</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Match OS</div>
                      </div>
                    </div>
                  </div>

                  <div style="border-top: 1px solid var(--border); padding-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                      <div>
                        <div style="font-weight: 500;">Compact Mode</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">Reduce spacing for more content</div>
                      </div>
                      <div style="width: 48px; height: 28px; background: var(--bg-secondary); border-radius: 14px; position: relative; cursor: pointer; border: 1px solid var(--border);">
                        <div style="width: 24px; height: 24px; background: white; border-radius: 50%; position: absolute; top: 1px; left: 2px;"></div>
                      </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <div style="font-weight: 500;">Show Line Numbers</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">Display line numbers in code blocks</div>
                      </div>
                      <div style="width: 48px; height: 28px; background: var(--primary); border-radius: 14px; position: relative; cursor: pointer;">
                        <div style="width: 24px; height: 24px; background: white; border-radius: 50%; position: absolute; top: 2px; right: 2px;"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Voice Input Section -->
              <div class="settings-section" id="settings-voice" style="display: none;">
                <h2 class="settings-section-title">Voice Input (Whisper)</h2>
                <p class="settings-section-desc">Enable voice-to-text for prompts using OpenAI Whisper.</p>

                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--bg-tertiary); border-radius: 8px;">
                  <div>
                    <div style="font-weight: 500;">Enable Voice Input</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">Use microphone to speak your prompts</div>
                  </div>
                  <div style="width: 48px; height: 28px; background: var(--primary); border-radius: 14px; position: relative; cursor: pointer;">
                    <div style="width: 24px; height: 24px; background: white; border-radius: 50%; position: absolute; top: 2px; right: 2px;"></div>
                  </div>
                </div>
              </div>

              <!-- Global Agents Section -->
              <div class="settings-section" id="settings-globalagents" style="display: none;">
                <h2 class="settings-section-title">Global Agents</h2>
                <p class="settings-section-desc">Define reusable agents available across all your projects. These are automatically inherited by new projects.</p>

                <!-- What are Agents? - Expandable Help -->
                <div style="margin: 16px 0;">
                  <div onclick="toggleSettingsAgentHelp()" style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 0;">
                    <span id="settings-agent-help-chevron" style="font-size: 10px; color: var(--text-muted); transition: transform 0.2s;"></span>
                    <span style="font-size: 13px; color: var(--primary);">What are Agents? How do they work?</span>
                  </div>
                  <div id="settings-agent-help-content" style="display: none; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-top: 8px;">
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">
                      <strong>Agents</strong> are specialized AI assistants with defined roles, capabilities, and constraints. They can be invoked by name to handle specific tasks.
                    </p>
                    <!-- Diagram -->
                    <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 24px; margin-bottom: 16px;">
                      <div style="text-align: center; font-size: 11px; color: var(--text-muted); margin-bottom: 12px;">HOW AGENTS WORK</div>
                      <div style="display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 12px;">
                        <div style="background: var(--primary); color: white; padding: 12px 16px; border-radius: 8px; text-align: center;">
                          <div style="font-size: 20px; margin-bottom: 4px;"></div>
                          <div>You</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; color: var(--text-muted);">
                          <div>@agent-name</div>
                          <div></div>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.2); border: 2px solid var(--primary); padding: 12px 16px; border-radius: 8px; text-align: center;">
                          <div style="font-size: 20px; margin-bottom: 4px;"></div>
                          <div>Agent</div>
                          <div style="font-size: 9px; color: var(--text-muted); margin-top: 4px;">Custom Role<br>+ Tools<br>+ Model</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; color: var(--text-muted);">
                          <div>performs</div>
                          <div></div>
                        </div>
                        <div style="background: var(--bg-secondary); border: 1px solid var(--border); padding: 12px 16px; border-radius: 8px; text-align: center;">
                          <div style="font-size: 20px; margin-bottom: 4px;"></div>
                          <div>Task</div>
                        </div>
                      </div>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                      <strong>Example Usage:</strong><br>
                      <code style="background: var(--bg-tertiary); padding: 4px 8px; border-radius: 4px; display: inline-block; margin: 8px 0;">@code-reviewer check src/api/users.js</code>
                      <br><br>
                      <strong>Agent Components:</strong>
                      <ul style="margin: 8px 0 0 20px;">
                        <li><strong>Name:</strong> How you invoke it (e.g., @code-reviewer)</li>
                        <li><strong>Description:</strong> What it does</li>
                        <li><strong>Tools:</strong> What capabilities it has (read-only, file edit, etc.)</li>
                        <li><strong>Model:</strong> Which LLM powers it (Opus for complex, Sonnet for fast)</li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <span style="font-weight: 500;">Your Global Agents</span>
                    <button class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="showAgentModal()">+ Create Agent</button>
                  </div>

                  <!-- Agent Item -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary);">
                          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                          <polyline points="14 2 14 8 20 8"></polyline>
                          <line x1="16" y1="13" x2="8" y2="13"></line>
                          <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                      </div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">code-reviewer</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 2px;">Reviews code for quality, security, and best practices. Provides actionable feedback.</div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                          <span style="font-size: 11px; background: var(--bg-tertiary); padding: 2px 8px; border-radius: 4px;">Read-only tools</span>
                          <span style="font-size: 11px; background: var(--bg-tertiary); padding: 2px 8px; border-radius: 4px;">Model: Sonnet</span>
                        </div>
                      </div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <!-- Active toggle -->
                        <div onclick="this.classList.toggle('inactive')" style="width: 36px; height: 20px; background: var(--success); border-radius: 10px; position: relative; cursor: pointer;">
                          <div style="width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; top: 2px; right: 2px;"></div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showAgentModal(true, {id: 'code-reviewer', name: 'code-reviewer', description: 'Reviews code for quality, security, and best practices. Provides actionable feedback.', model: 'sonnet', tools: 'readonly'})">Edit</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>

                  <!-- Agent Item 2 -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(239, 68, 68, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #ef4444;">
                          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                      </div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">security-audit</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 2px;">Scans code for vulnerabilities, checks dependencies, and suggests security improvements.</div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                          <span style="font-size: 11px; background: var(--bg-tertiary); padding: 2px 8px; border-radius: 4px;">Read-only tools</span>
                          <span style="font-size: 11px; background: var(--bg-tertiary); padding: 2px 8px; border-radius: 4px;">Model: Opus</span>
                        </div>
                      </div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div onclick="this.classList.toggle('inactive')" style="width: 36px; height: 20px; background: var(--success); border-radius: 10px; position: relative; cursor: pointer;">
                          <div style="width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; top: 2px; right: 2px;"></div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showAgentModal(true, {id: 'security-audit', name: 'security-audit', description: 'Scans code for vulnerabilities, checks dependencies, and suggests security improvements.', model: 'opus', tools: 'readonly'})">Edit</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>

                  <!-- Agent Item 3 -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(34, 197, 94, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #22c55e;">
                          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                          <polyline points="14 2 14 8 20 8"></polyline>
                          <path d="m9 15 2 2 4-4"></path>
                        </svg>
                      </div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">test-writer</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 2px;">Generates unit tests, integration tests, and test fixtures based on your code.</div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                          <span style="font-size: 11px; background: var(--bg-tertiary); padding: 2px 8px; border-radius: 4px;">All tools</span>
                          <span style="font-size: 11px; background: var(--bg-tertiary); padding: 2px 8px; border-radius: 4px;">Model: Sonnet</span>
                        </div>
                      </div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <div onclick="this.classList.toggle('inactive')" style="width: 36px; height: 20px; background: var(--success); border-radius: 10px; position: relative; cursor: pointer;">
                          <div style="width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; top: 2px; right: 2px;"></div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showAgentModal(true, {id: 'test-writer', name: 'test-writer', icon: '', description: 'Generates unit tests, integration tests, and test fixtures based on your code.', model: 'sonnet', tools: 'all'})">Edit</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid var(--primary);">
                  <div style="font-size: 13px; color: var(--text-secondary);">
                    <strong> Tip:</strong> Global agents are automatically converted to the correct format (CLAUDE.md agents, Codex skills, or system prompts) based on which LLM you use in each project.
                  </div>
                </div>
              </div>

              <!-- Global Skills Section -->
              <div class="settings-section" id="settings-globalskills" style="display: none;">
                <h2 class="settings-section-title">Global Skills</h2>
                <p class="settings-section-desc">Skills are reusable task modules that teach the AI specific workflows. These are available across all projects.</p>

                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; margin-top: 16px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <span style="font-weight: 500;">Your Global Skills</span>
                    <div style="display: flex; gap: 8px;">
                      <button class="btn btn-secondary" style="padding: 8px 16px; font-size: 13px;">Browse Registry</button>
                      <button class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="showSkillModal()">+ Create Skill</button>
                    </div>
                  </div>

                  <!-- Skill Item -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(168, 85, 247, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px;"></div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">doc-generator</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 2px;">Generates documentation from code including README, API docs, and inline comments.</div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                          <span style="font-size: 11px; background: rgba(34, 197, 94, 0.2); color: var(--success); padding: 2px 8px; border-radius: 4px;">Installed</span>
                        </div>
                      </div>
                      <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showSkillModal(true, {id: 'doc-generator', name: 'doc-generator', icon: '', description: 'Generates documentation from code including README, API docs, and inline comments.'})">Configure</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>

                  <!-- Skill Item 2 -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(249, 115, 22, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px;"></div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">data-analysis</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 2px;">Analyzes data files, generates reports, and creates visualizations.</div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                          <span style="font-size: 11px; background: rgba(34, 197, 94, 0.2); color: var(--success); padding: 2px 8px; border-radius: 4px;">Installed</span>
                        </div>
                      </div>
                      <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showSkillModal(true, {id: 'data-analysis', name: 'data-analysis', icon: '', description: 'Analyzes data files, generates reports, and creates visualizations.'})">Configure</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>

                  <!-- Skill Item 3 -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px;"></div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">frontend-design</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 2px;">Creates UI components, layouts, and responsive designs following best practices.</div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                          <span style="font-size: 11px; background: rgba(34, 197, 94, 0.2); color: var(--success); padding: 2px 8px; border-radius: 4px;">Installed</span>
                        </div>
                      </div>
                      <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showSkillModal(true, {id: 'frontend-design', name: 'frontend-design', icon: '', description: 'Creates UI components, layouts, and responsive designs following best practices.'})">Configure</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Global MCP Servers Section -->
              <div class="settings-section" id="settings-globalmcp" style="display: none;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                  <h2 class="settings-section-title" style="margin: 0;">Global MCP Servers</h2>
                  <!-- Warning icon -->
                  <div onclick="toggleSettingsMCPWarning()" style="cursor: pointer; position: relative;">
                    <span style="color: var(--accent);"></span>
                    <div id="settings-mcp-warning-tooltip" style="display: none; position: absolute; left: 50%; transform: translateX(-50%); top: 100%; margin-top: 8px; background: var(--bg-secondary); border: 1px solid var(--accent); border-radius: 8px; padding: 12px; width: 280px; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                      <div style="font-size: 12px; font-weight: 600; color: var(--accent); margin-bottom: 6px;"> MCP Context Warning</div>
                      <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.5;">
                        Each MCP server adds tool descriptions to your context window. Too many can:
                        <ul style="margin: 8px 0 0 16px; padding: 0;">
                          <li>Use up valuable context tokens</li>
                          <li>Confuse the LLM with too many options</li>
                          <li>Slow down response times</li>
                        </ul>
                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border);">
                          <strong>Recommendation:</strong> Keep 3-5 active MCPs per project.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <p class="settings-section-desc">MCP (Model Context Protocol) servers connect AI to external tools and data sources. These are available across all projects.</p>

                <!-- What is MCP? - Expandable Help -->
                <div style="margin: 16px 0;">
                  <div onclick="toggleSettingsMCPHelp()" style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 0;">
                    <span id="settings-mcp-help-chevron" style="font-size: 10px; color: var(--text-muted); transition: transform 0.2s;"></span>
                    <span style="font-size: 13px; color: var(--primary);">What is MCP? How does it work?</span>
                  </div>
                  <div id="settings-mcp-help-content" style="display: none; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-top: 8px;">
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">
                      <strong>MCP (Model Context Protocol)</strong> is a universal standard that connects AI assistants to external tools and data sources. It works with Claude, ChatGPT, Codex, and more.
                    </p>
                    <!-- Diagram -->
                    <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 24px; margin-bottom: 16px;">
                      <div style="text-align: center; font-size: 11px; color: var(--text-muted); margin-bottom: 12px;">HOW MCP WORKS</div>
                      <div style="display: flex; align-items: center; justify-content: center; gap: 16px; font-size: 12px;">
                        <div style="background: var(--primary); color: white; padding: 12px 16px; border-radius: 8px; text-align: center;">
                          <div style="font-size: 24px; margin-bottom: 4px;"></div>
                          <div>Any LLM</div>
                          <div style="font-size: 9px; opacity: 0.8; margin-top: 2px;">Claude, GPT, etc.</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; color: var(--text-muted);">
                          <div style="font-size: 10px;">JSON-RPC</div>
                          <div></div>
                        </div>
                        <div style="background: rgba(168, 85, 247, 0.2); border: 2px solid #a855f7; padding: 12px 16px; border-radius: 8px; text-align: center;">
                          <div style="font-size: 24px; margin-bottom: 4px;"></div>
                          <div>MCP Server</div>
                          <div style="font-size: 9px; color: var(--text-muted); margin-top: 2px;">Translates requests</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; color: var(--text-muted);">
                          <div style="font-size: 10px;">API calls</div>
                          <div></div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                          <div style="background: var(--bg-secondary); border: 1px solid var(--border); padding: 6px 12px; border-radius: 6px; font-size: 11px; text-align: center;"> GitHub</div>
                          <div style="background: var(--bg-secondary); border: 1px solid var(--border); padding: 6px 12px; border-radius: 6px; font-size: 11px; text-align: center;"> PostgreSQL</div>
                          <div style="background: var(--bg-secondary); border: 1px solid var(--border); padding: 6px 12px; border-radius: 6px; font-size: 11px; text-align: center;"> Slack</div>
                        </div>
                      </div>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                      <strong>Example Usage:</strong><br>
                      With PostgreSQL MCP connected, you can ask:<br>
                      <code style="background: var(--bg-tertiary); padding: 4px 8px; border-radius: 4px; display: inline-block; margin: 8px 0;">"Show me all users who signed up this week"</code>
                      <br>
                      Claude will automatically query your database and return results!
                    </div>
                  </div>
                </div>

                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <div>
                      <span style="font-weight: 500;">Connected MCP Servers</span>
                      <span style="font-size: 12px; color: var(--text-muted); margin-left: 8px;">3 active</span>
                    </div>
                    <div style="display: flex; gap: 8px;">
                      <button class="btn btn-secondary" style="padding: 8px 16px; font-size: 13px;">Browse Registry</button>
                      <button class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="showMCPModal()">+ Add Server</button>
                    </div>
                  </div>

                  <!-- MCP Item -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(36, 41, 46, 1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                      </div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">GitHub</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">Repository access, PR management, issues</div>
                      </div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 12px; color: var(--success);"> Connected</span>
                        <div onclick="this.classList.toggle('inactive')" style="width: 36px; height: 20px; background: var(--success); border-radius: 10px; position: relative; cursor: pointer;">
                          <div style="width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; top: 2px; right: 2px;"></div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showMCPModal(true, {id: 'github', type: 'api'})">Configure</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>

                  <!-- MCP Item 2 -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(74, 21, 75, 1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                      </div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">Slack</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">Send messages, read channels, manage notifications</div>
                      </div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 12px; color: var(--success);"> Connected</span>
                        <div onclick="this.classList.toggle('inactive')" style="width: 36px; height: 20px; background: var(--success); border-radius: 10px; position: relative; cursor: pointer;">
                          <div style="width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; top: 2px; right: 2px;"></div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showMCPModal(true, {id: 'slack', type: 'api'})">Configure</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>

                  <!-- MCP Item 3 -->
                  <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(66, 133, 244, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #4285f4;">
                          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        </svg>
                      </div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">Google Drive</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">Access files, create docs, manage folders</div>
                      </div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 12px; color: var(--success);"> Connected</span>
                        <div onclick="this.classList.toggle('inactive')" style="width: 36px; height: 20px; background: var(--success); border-radius: 10px; position: relative; cursor: pointer;">
                          <div style="width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; top: 2px; right: 2px;"></div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="showMCPModal(true, {id: 'gdrive', type: 'api'})">Configure</button>
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Remove</button>
                      </div>
                    </div>
                  </div>

                  <!-- Available MCP Item -->
                  <div style="background: var(--bg-secondary); border: 1px dashed var(--border); border-radius: 8px; padding: 16px; opacity: 0.7;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <div style="width: 40px; height: 40px; background: rgba(234, 179, 8, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #eab308;">
                          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                          <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                      </div>
                      <div style="flex: 1;">
                        <div style="font-weight: 500;">Gmail</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">Read and send emails, manage labels</div>
                      </div>
                      <button class="btn btn-primary" style="padding: 6px 16px; font-size: 12px;">Connect</button>
                    </div>
                  </div>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 3px solid var(--primary);">
                  <div style="font-size: 13px; color: var(--text-secondary);">
                    <strong> Universal Standard:</strong> MCP is supported by Claude, OpenAI Codex, and most modern AI tools. Servers configured here work with any LLM you use in your projects.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

  <!-- ==================== CREATE PROJECT VIEW ==================== -->
  <div id="view-create-project" class="view">
    <div style="background: var(--bg-primary); height: calc(100vh - 44px); display: flex; flex-direction: column;">
      <!-- Scrollable Content Area -->
      <div style="flex: 1; overflow-y: auto; padding: 24px;">
        <div style="max-width: 720px; margin: 0 auto;">
        
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 8px;">Create New Project</h1>
        <p style="color: var(--text-secondary); margin-bottom: 32px;">Follow the steps to configure your environment and AI models.</p>

        <!-- Step 1: Project Details -->
        <div class="settings-panel" style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600;">1</div>
            <h2 style="font-size: 18px; font-weight: 600;">Project Details</h2>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div>
              <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Workspace</label>
              <select class="model-select" style="width: 100%;">
                <option>Customers</option>
                <option>Personal</option>
                <option> Create New Workspace...</option>
              </select>
            </div>
            <div>
              <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Project Name</label>
              <input type="text" class="model-select" style="width: 100%;" placeholder="e.g. Family Calendar App">
            </div>
          </div>

          <!-- Project Brief -->
          <div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;">Project Brief</label>
              <div style="display: flex; align-items: center; gap: 8px;">
                <label for="brief-file-upload" style="font-size: 11px; color: var(--primary); cursor: pointer; display: flex; align-items: center; gap: 4px;">
                   Upload .md file
                </label>
                <input type="file" id="brief-file-upload" accept=".md,.txt" style="display: none;" onchange="handleBriefUpload(this)">
              </div>
            </div>
            
            <textarea id="project-brief" class="model-select" style="width: 100%; min-height: 100px; font-size: 13px; resize: vertical;" placeholder="Describe what you want to build in plain language...

Examples:
 I want to build a calendar app for my family
 Build a reservation booking system for my restaurant  
 Help me research and plan my trip to Italy
 Create a simple inventory tracker for my small business"></textarea>
            
            <!-- Submit button that triggers AI -->
            <div style="display: flex; justify-content: flex-end; margin-top: 12px;">
              <button onclick="startProjectDefinition()" class="define-ai-btn" style="padding: 10px 20px; font-size: 13px; font-weight: 500; background: linear-gradient(135deg, #D97757 0%, #C4694A 100%); color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(217, 119, 87, 0.3);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M12 2L14.5 9H22L16 14L18.5 21L12 16.5L5.5 21L8 14L2 9H9.5L12 2Z" fill="currentColor"/>
                </svg>
                Define Project with AI
              </button>
            </div>
            
            <!-- AI Chat for Brief (collapsed by default) -->
            <div id="ai-brief-chat" style="display: none; margin-top: 16px; background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border); overflow: hidden;">
              <!-- Chat Header -->
              <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--bg-tertiary); border-bottom: 1px solid var(--border);">
                <div style="display: flex; align-items: center; gap: 10px;">
                  <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #D97757 0%, #C4694A 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                      <path d="M12 2L14.5 9H22L16 14L18.5 21L12 16.5L5.5 21L8 14L2 9H9.5L12 2Z" fill="currentColor"/>
                    </svg>
                  </div>
                  <div>
                    <div style="font-size: 14px; font-weight: 600;">Project Definition Assistant</div>
                    <div style="font-size: 11px; color: var(--text-muted);">Claude is helping define your project</div>
                  </div>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="font-size: 10px; color: var(--success); display: flex; align-items: center; gap: 4px;">
                    <span style="width: 6px; height: 6px; background: var(--success); border-radius: 50%;"></span>
                    Active
                  </div>
                  <button onclick="collapseAIChat()" style="background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
              </div>
              
              <!-- Chat messages area -->
              <div id="brief-chat-messages" style="height: 280px; overflow-y: auto; padding: 16px;">
                <!-- AI Initial Message -->
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                  <div style="width: 28px; height: 28px; background: linear-gradient(135deg, #D97757 0%, #C4694A 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; color: white;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                      <path d="M12 2L14.5 9H22L16 14L18.5 21L12 16.5L5.5 21L8 14L2 9H9.5L12 2Z" fill="currentColor"/>
                    </svg>
                  </div>
                  <div style="flex: 1; background: var(--bg-tertiary); border-radius: 8px; padding: 12px; font-size: 13px; line-height: 1.5;">
                    <p style="margin-bottom: 8px;">I've analyzed your project brief. Let me help you refine the details:</p>
                    <p style="margin-bottom: 12px;">Based on <strong>"I want to build a calendar app for my family"</strong>, I have a few questions:</p>
                    <ol style="margin: 0; padding-left: 20px; color: var(--text-secondary);">
                      <li style="margin-bottom: 6px;">How many family members will use it?</li>
                      <li style="margin-bottom: 6px;">Do you need features like shared events, reminders, or recurring events?</li>
                      <li style="margin-bottom: 6px;">Should it sync with existing calendars (Google Calendar, iCal)?</li>
                    </ol>
                  </div>
                </div>
                
                <!-- User Response -->
                <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
                  <div style="background: var(--primary); color: white; border-radius: 8px; padding: 10px 14px; font-size: 13px; max-width: 80%;">
                    5 family members. Yes to shared events and reminders. Google Calendar sync would be great!
                  </div>
                </div>
                
                <!-- AI Follow-up -->
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                  <div style="width: 28px; height: 28px; background: linear-gradient(135deg, #D97757 0%, #C4694A 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; color: white;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                      <path d="M12 2L14.5 9H22L16 14L18.5 21L12 16.5L5.5 21L8 14L2 9H9.5L12 2Z" fill="currentColor"/>
                    </svg>
                  </div>
                  <div style="flex: 1; background: var(--bg-tertiary); border-radius: 8px; padding: 12px; font-size: 13px; line-height: 1.5;">
                    <p style="margin-bottom: 8px;">Perfect! Here's what I've captured for your project:</p>
                    <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; padding: 10px; margin-bottom: 12px; font-size: 12px;">
                      <div style="font-weight: 600; margin-bottom: 6px; color: var(--primary);"> Project Summary</div>
                      <ul style="margin: 0; padding-left: 16px; color: var(--text-secondary);">
                        <li>Family calendar app for 5 users</li>
                        <li>Shared events & reminders</li>
                        <li>Google Calendar integration</li>
                        <li>Suggested stack: React + Node.js + PostgreSQL</li>
                      </ul>
                    </div>
                    <p style="margin: 0; color: var(--text-muted); font-size: 12px;">Click "Generate Project Context" to create your CLAUDE.md and project configuration.</p>
                  </div>
                </div>
              </div>
              
              <!-- Chat input -->
              <div style="padding: 12px 16px; border-top: 1px solid var(--border); background: var(--bg-tertiary);">
                <div style="display: flex; gap: 8px; align-items: center;">
                  <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 6px;" title="Attach file">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                    </svg>
                  </button>
                  <div style="flex: 1; position: relative;">
                    <input type="text" id="ai-chat-input" class="model-select" style="width: 100%; font-size: 13px; padding-right: 36px;" placeholder="Ask follow-up questions..." onkeypress="if(event.key==='Enter') sendBriefMessage()">
                    <button onclick="toggleVoiceInput()" id="voice-btn" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-muted);" title="Voice input">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                      </svg>
                    </button>
                  </div>
                  <button onclick="sendBriefMessage()" class="btn btn-primary" style="padding: 8px 14px; font-size: 13px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="22" y1="2" x2="11" y2="13"></line>
                      <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                  </button>
                </div>
                
                <!-- Voice recording indicator (hidden by default) -->
                <div id="voice-recording" style="display: none; margin-top: 8px; padding: 8px 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--error); border-radius: 6px;">
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 8px; height: 8px; background: var(--error); border-radius: 50%; animation: pulse 1s infinite;"></div>
                    <span style="font-size: 12px; color: var(--error);">Recording... Click mic to stop</span>
                  </div>
                </div>
              </div>
              
              <!-- Quick actions -->
              <div id="ai-chat-actions" style="display: flex; padding: 12px 16px; gap: 8px; border-top: 1px solid var(--border); background: var(--bg-secondary);">
                <button onclick="generateProjectContext()" class="btn btn-primary" style="flex: 1; padding: 10px; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                  </svg>
                  Generate Project Context
                </button>
                <button onclick="continueConversation()" class="btn btn-secondary" style="padding: 10px 16px; font-size: 13px;">
                  Ask More
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Connection Source -->
        <div class="settings-panel" style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600;">2</div>
            <h2 style="font-size: 18px; font-weight: 600;">Connection Source</h2>
          </div>

          <!-- Free Cloud Hosting - Primary Expanded Card -->
          <div id="github-card" style="background: var(--bg-tertiary); border: 2px solid var(--primary); border-radius: 12px; padding: 24px; margin-bottom: 16px; position: relative;">
            <div style="position: absolute; top: -10px; right: 16px; background: var(--success); color: white; padding: 3px 10px; border-radius: 4px; font-size: 10px; font-weight: 600;">RECOMMENDED</div>
            
            <!-- Header -->
            <div style="display: flex; align-items: center; gap: 14px; margin-bottom: 12px;">
              <div style="width: 48px; height: 48px; background: rgba(34, 197, 94, 0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--success);">
                  <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
                </svg>
              </div>
              <div>
                <div style="font-size: 18px; font-weight: 600;">Free Cloud Hosting</div>
                <div style="font-size: 13px; color: var(--text-secondary);">Powered by GitHub</div>
              </div>
            </div>
            
            <!-- Description -->
            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px; line-height: 1.5;">
              Get free cloud hosting, storage, and preview environments. Your code stays in your GitHub account.
            </p>
            
            <!-- Benefits -->
            <div style="display: flex; gap: 24px; margin-bottom: 24px; flex-wrap: wrap;">
              <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text-primary);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                60 hrs/mo free compute
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text-primary);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                15GB storage
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text-primary);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                You own your code
              </div>
            </div>
            
            <!-- Not connected state -->
            <div id="github-not-connected" style="padding: 24px; background: var(--bg-primary); border-radius: 10px; border: 1px solid var(--border); text-align: center;">
              <div style="display: flex; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap;">
                <button onclick="connectGitHub()" class="github-signin-btn" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: #24292e; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                  </svg>
                  Sign in with GitHub
                </button>
                
                <span style="color: var(--text-muted); font-size: 13px;">or</span>
                
                <a href="https://github.com/signup" target="_blank" class="github-create-btn" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: var(--success); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; text-decoration: none; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);">
                  Create Free Account
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </a>
              </div>
            </div>
            
            <!-- Connected state (hidden by default) -->
            <div id="github-connected" style="display: none; padding: 16px; background: var(--bg-primary); border-radius: 10px; border: 1px solid var(--border);">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <img src="https://github.com/identicons/jasonlong.png" style="width: 44px; height: 44px; border-radius: 10px;" alt="GitHub avatar">
                <div style="flex: 1;">
                  <div style="font-weight: 600; font-size: 14px;">alex-engineer</div>
                  <div style="font-size: 12px; color: var(--text-secondary);">GitHub Personal Account</div>
                </div>
                <span style="background: var(--success); color: white; padding: 4px 12px; border-radius: 6px; font-size: 11px; font-weight: 600;">CONNECTED</span>
              </div>
              
              <div style="margin-bottom: 16px;">
                <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Repository</label>
                <select class="model-select" style="width: 100%;">
                  <option> Create new repository</option>
                  <option>alex-engineer / hubllm-core</option>
                  <option>alex-engineer / frontend-kit</option>
                </select>
              </div>
              
              <div style="padding: 12px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; font-size: 12px; color: var(--success);">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  Ready! Code will be pushed to your GitHub. Preview via Codespaces.
                </div>
              </div>
            </div>
          </div>

          <!-- VPS - Collapsible Card -->
          <div id="vps-card" style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 12px; overflow: hidden;">
            <!-- VPS Header (always visible) -->
            <div onclick="toggleVPSCard()" style="display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; cursor: pointer;">
              <div style="display: flex; align-items: center; gap: 14px;">
                <div style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary);">
                    <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
                    <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
                    <line x1="6" y1="6" x2="6.01" y2="6"></line>
                    <line x1="6" y1="18" x2="6.01" y2="18"></line>
                  </svg>
                </div>
                <div>
                  <div style="font-size: 15px; font-weight: 600;">Connect to VPS</div>
                  <div style="font-size: 12px; color: var(--text-muted);">Advanced  For power users with their own servers</div>
                </div>
              </div>
              <div id="vps-toggle-icon" style="color: var(--text-muted); transition: transform 0.2s;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            
            <!-- VPS Fields (hidden by default) -->
            <div id="fields-vps" style="display: none; padding: 0 20px 20px 20px; border-top: 1px solid var(--border);">
              <div style="padding-top: 16px;">
                <div style="margin-bottom: 12px;">
                  <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Select Server</label>
                  <select class="model-select" style="width: 100%;">
                    <option> Add New VPS</option>
                    <option>prod-01 (192.168.1.104)</option>
                    <option>staging-01 (192.168.1.105)</option>
                  </select>
                </div>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 12px; margin-bottom: 12px;">
                  <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">IP Address</label>
                    <input type="text" class="model-select" style="width: 100%;" placeholder="0.0.0.0">
                  </div>
                  <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Port</label>
                    <input type="text" class="model-select" style="width: 100%;" value="22">
                  </div>
                </div>
                <div>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;">SSH Private Key</label>
                    <a href="#" style="color: var(--primary); font-size: 12px; text-decoration: none;"> Help finding key</a>
                  </div>
                  <textarea class="model-select" style="width: 100%; min-height: 80px; font-family: Monaco, Consolas, monospace; font-size: 11px;" placeholder="-----BEGIN RSA PRIVATE KEY-----&#10;..."></textarea>
                </div>
                
                <!-- Test Connection Button for VPS -->
                <div style="margin-top: 16px; display: flex; justify-content: flex-end;">
                  <button onclick="testVPSConnection()" class="btn btn-secondary" style="display: flex; align-items: center; gap: 6px; padding: 8px 16px; font-size: 12px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                    </svg>
                    Test Connection
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Project Context (Generated) -->
        <div class="settings-panel" style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600;">3</div>
            <h2 style="font-size: 18px; font-weight: 600;">Project Context</h2>
            <span id="context-generated-badge" style="display: none; font-size: 10px; background: rgba(34, 197, 94, 0.2); color: var(--success); padding: 2px 8px; border-radius: 4px;"> Generated from Brief</span>
          </div>
          
          <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 16px;">
            This will be auto-converted to CLAUDE.md, AGENTS.md, or system prompts based on your LLM.
          </p>

          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Tech Stack</label>
            <input id="ctx-tech-stack" type="text" class="model-select" style="width: 100%;" placeholder="e.g., Node.js, Express, PostgreSQL, Redis">
          </div>

          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Code Standards</label>
            <textarea id="ctx-standards" class="model-select" style="width: 100%; min-height: 70px; font-size: 13px;" placeholder="e.g., TypeScript strict mode, async/await patterns, JSDoc comments..."></textarea>
          </div>

          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Common Commands</label>
            <div style="display: grid; gap: 8px;">
              <div style="display: flex; gap: 8px;">
                <input type="text" class="model-select" style="width: 140px; font-size: 12px;" placeholder="npm run dev">
                <input type="text" class="model-select" style="flex: 1; font-size: 12px;" placeholder="Start dev server">
              </div>
              <div style="display: flex; gap: 8px;">
                <input type="text" class="model-select" style="width: 140px; font-size: 12px;" placeholder="npm test">
                <input type="text" class="model-select" style="flex: 1; font-size: 12px;" placeholder="Run tests">
              </div>
              <button class="btn btn-secondary" style="width: fit-content; padding: 6px 12px; font-size: 11px;">+ Add Command</button>
            </div>
          </div>

          <div style="padding: 10px; background: rgba(59, 130, 246, 0.1); border-radius: 6px; margin-bottom: 16px;">
            <div style="font-size: 11px; color: var(--text-secondary);">
               After creating, use <code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">/init</code> in chat to auto-detect more context from your codebase.
            </div>
          </div>

          <!-- Action buttons for Project Context -->
          <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
              <button onclick="generateProjectContext()" class="btn btn-secondary" style="display: flex; align-items: center; gap: 6px; padding: 10px 16px;">
                <span></span> Auto-Gen
              </button>
              <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px; padding-left: 4px;">
                Pulls from Project Brief above
              </div>
            </div>
            <button onclick="submitProjectContext()" class="btn btn-primary" style="padding: 10px 24px;">
              Save Context
            </button>
          </div>
        </div>

        <!-- Step 4: Project Agents -->
        <div class="settings-panel" style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600;">4</div>
            <h2 style="font-size: 18px; font-weight: 600;">Project Agents</h2>
          </div>

          <!-- What are Agents? -->
          <div style="margin-bottom: 16px;">
            <div onclick="toggleAgentHelp()" style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 6px 0;">
              <span id="agent-help-chevron" style="font-size: 10px; color: var(--text-muted); transition: transform 0.2s;"></span>
              <span style="font-size: 12px; color: var(--primary);">What are Agents?</span>
            </div>
            <div id="agent-help-content" style="display: none; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-top: 8px;">
              <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                <strong>Agents</strong> are specialized AI assistants. Invoke with <code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">@agent-name</code> in chat.
              </p>
              <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; font-size: 11px;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                  <span style="background: var(--primary); color: white; padding: 4px 8px; border-radius: 4px;"> You</span>
                  <span style="color: var(--text-muted);"> @code-reviewer </span>
                  <span style="background: rgba(59, 130, 246, 0.2); border: 1px solid var(--primary); padding: 4px 8px; border-radius: 4px;"> Agent</span>
                  <span style="color: var(--text-muted);"> reviews </span>
                  <span style="background: var(--bg-secondary); border: 1px solid var(--border); padding: 4px 8px; border-radius: 4px;"> Code</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Global Agents - Expandable with individual checkboxes -->
          <div style="background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 16px;">
            <div style="display: flex; align-items: center; gap: 10px; padding: 12px;">
              <input type="checkbox" id="global-agents-master" checked style="width: 18px; height: 18px;" onclick="toggleAllGlobalAgents(this)">
              <div style="flex: 1; cursor: pointer;" onclick="toggleGlobalAgents()">
                <div style="font-size: 13px; font-weight: 500;">Include Global Agents</div>
                <div id="global-agents-count" style="font-size: 11px; color: var(--text-muted);">3 agents selected</div>
              </div>
              <span id="global-agents-chevron" style="font-size: 12px; color: var(--text-muted); transition: transform 0.2s; cursor: pointer;" onclick="toggleGlobalAgents()"></span>
            </div>
            <!-- Expanded list -->
            <div id="global-agents-list" style="border-top: 1px solid var(--border); padding: 8px;">
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px;">
                <input type="checkbox" checked class="global-agent-checkbox" onchange="updateGlobalAgentsMaster()" style="width: 16px; height: 16px;">
                <div style="width: 24px; height: 24px; background: rgba(59, 130, 246, 0.15); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary);">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <div style="font-size: 12px; font-weight: 500;">code-reviewer</div>
                  <div style="font-size: 10px; color: var(--text-muted);">Reviews code for quality and best practices</div>
                </div>
                <span onclick="showView('settings'); showSettingsTab('globalagents')" style="font-size: 10px; color: var(--primary); cursor: pointer;">Edit Global </span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px;">
                <input type="checkbox" checked class="global-agent-checkbox" onchange="updateGlobalAgentsMaster()" style="width: 16px; height: 16px;">
                <div style="width: 24px; height: 24px; background: rgba(239, 68, 68, 0.15); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #ef4444;">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <div style="font-size: 12px; font-weight: 500;">security-audit</div>
                  <div style="font-size: 10px; color: var(--text-muted);">Scans for vulnerabilities</div>
                </div>
                <span onclick="showView('settings'); showSettingsTab('globalagents')" style="font-size: 10px; color: var(--primary); cursor: pointer;">Edit Global </span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px;">
                <input type="checkbox" checked class="global-agent-checkbox" onchange="updateGlobalAgentsMaster()" style="width: 16px; height: 16px;">
                <div style="width: 24px; height: 24px; background: rgba(34, 197, 94, 0.15); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #22c55e;">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <path d="m9 15 2 2 4-4"></path>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <div style="font-size: 12px; font-weight: 500;">test-writer</div>
                  <div style="font-size: 10px; color: var(--text-muted);">Generates unit and integration tests</div>
                </div>
                <span onclick="showView('settings'); showSettingsTab('globalagents')" style="font-size: 10px; color: var(--primary); cursor: pointer;">Edit Global </span>
              </div>
            </div>
          </div>

          <!-- Project-specific agents -->
          <div style="font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Project-Specific Agents</div>
          
          <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 10px 12px; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 24px; height: 24px; background: rgba(249, 115, 22, 0.15); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #f97316;">
                  <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                </svg>
              </div>
              <div style="flex: 1;">
                <div style="font-size: 12px; font-weight: 500;">api-designer</div>
                <div style="font-size: 10px; color: var(--text-muted);">Designs REST API endpoints</div>
              </div>
              <div style="display: flex; align-items: center; gap: 6px;">
                <span style="font-size: 10px; color: var(--primary); cursor: pointer;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                    <path d="M12 19V5M5 12l7-7 7 7"/>
                  </svg>
                  Add to Global
                </span>
                <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 12px;"></button>
              </div>
            </div>
          </div>

          <button class="btn btn-secondary" style="width: 100%; padding: 10px; font-size: 12px;">+ Add Project Agent</button>
        </div>

        <!-- Step 5: MCP Servers -->
        <div class="settings-panel" style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600;">5</div>
            <h2 style="font-size: 18px; font-weight: 600;">MCP Servers</h2>
            <div onclick="toggleMCPWarning()" style="cursor: pointer; position: relative;">
              <span style="color: var(--accent);"></span>
              <div id="mcp-warning-tooltip" style="display: none; position: absolute; left: 50%; transform: translateX(-50%); top: 100%; margin-top: 8px; background: var(--bg-secondary); border: 1px solid var(--accent); border-radius: 8px; padding: 12px; width: 240px; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                <div style="font-size: 11px; font-weight: 600; color: var(--accent); margin-bottom: 6px;"> Context Warning</div>
                <div style="font-size: 10px; color: var(--text-secondary); line-height: 1.4;">
                  Each MCP server uses context tokens. Keep 3-5 active per project for best performance.
                </div>
              </div>
            </div>
          </div>

          <!-- What is MCP? -->
          <div style="margin-bottom: 16px;">
            <div onclick="toggleMCPHelp()" style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 6px 0;">
              <span id="mcp-help-chevron" style="font-size: 10px; color: var(--text-muted); transition: transform 0.2s;"></span>
              <span style="font-size: 12px; color: var(--primary);">What is MCP?</span>
            </div>
            <div id="mcp-help-content" style="display: none; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-top: 8px;">
              <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                <strong>MCP</strong> connects AI to external tools (databases, APIs, services). Works with any LLM.
              </p>
              <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; font-size: 10px;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 4px;">
                  <span style="background: var(--primary); color: white; padding: 4px 6px; border-radius: 4px;"> LLM</span>
                  <span style="color: var(--text-muted);"></span>
                  <span style="background: rgba(168, 85, 247, 0.2); border: 1px solid #a855f7; padding: 4px 6px; border-radius: 4px;"> MCP</span>
                  <span style="color: var(--text-muted);"></span>
                  <span style="background: var(--bg-secondary); border: 1px solid var(--border); padding: 4px 6px; border-radius: 4px;"> DB /  Git /  Slack</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Global MCP - Expandable with individual checkboxes -->
          <div style="background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 16px;">
            <div style="display: flex; align-items: center; gap: 10px; padding: 12px;">
              <input type="checkbox" id="global-mcp-master" checked style="width: 18px; height: 18px;" onclick="toggleAllGlobalMCP(this)">
              <div style="flex: 1; cursor: pointer;" onclick="toggleGlobalMCP()">
                <div style="font-size: 13px; font-weight: 500;">Include Global MCP Servers</div>
                <div id="global-mcp-count" style="font-size: 11px; color: var(--text-muted);">2 of 3 servers selected</div>
              </div>
              <span id="global-mcp-chevron" style="font-size: 12px; color: var(--text-muted); transition: transform 0.2s; cursor: pointer;" onclick="toggleGlobalMCP()"></span>
            </div>
            <!-- Expanded list -->
            <div id="global-mcp-list" style="border-top: 1px solid var(--border); padding: 8px;">
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px;">
                <input type="checkbox" checked class="global-mcp-checkbox" onchange="updateGlobalMCPMaster()" style="width: 16px; height: 16px;">
                <div style="width: 24px; height: 24px; background: rgba(36, 41, 46, 0.8); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="white">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <div style="font-size: 12px; font-weight: 500;">GitHub</div>
                  <div style="font-size: 10px; color: var(--success);"> Connected</div>
                </div>
                <span onclick="showView('settings'); showSettingsTab('globalmcp')" style="font-size: 10px; color: var(--primary); cursor: pointer;">Edit Global </span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px;">
                <input type="checkbox" checked class="global-mcp-checkbox" onchange="updateGlobalMCPMaster()" style="width: 16px; height: 16px;">
                <div style="width: 24px; height: 24px; background: rgba(74, 21, 75, 0.8); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <div style="font-size: 12px; font-weight: 500;">Slack</div>
                  <div style="font-size: 10px; color: var(--success);"> Connected</div>
                </div>
                <span onclick="showView('settings'); showSettingsTab('globalmcp')" style="font-size: 10px; color: var(--primary); cursor: pointer;">Edit Global </span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 6px; opacity: 0.5;">
                <input type="checkbox" class="global-mcp-checkbox" onchange="updateGlobalMCPMaster()" style="width: 16px; height: 16px;">
                <div style="width: 24px; height: 24px; background: rgba(66, 133, 244, 0.2); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #4285f4;">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <div style="font-size: 12px; font-weight: 500;">Google Drive</div>
                  <div style="font-size: 10px; color: var(--text-muted);">Not selected</div>
                </div>
                <span onclick="showView('settings'); showSettingsTab('globalmcp')" style="font-size: 10px; color: var(--primary); cursor: pointer;">Edit Global </span>
              </div>
            </div>
          </div>

          <!-- Project-specific MCP -->
          <div style="font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Project-Specific Servers</div>
          
          <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 10px 12px; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 24px; height: 24px; background: rgba(51, 103, 145, 0.2); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #336791;">
                  <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                  <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                  <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                </svg>
              </div>
              <div style="flex: 1;">
                <div style="font-size: 12px; font-weight: 500;">PostgreSQL</div>
                <div style="font-size: 10px; color: var(--success);"> Ready to connect</div>
              </div>
              <div style="display: flex; align-items: center; gap: 6px;">
                <span style="font-size: 10px; color: var(--primary); cursor: pointer;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                    <path d="M12 19V5M5 12l7-7 7 7"/>
                  </svg>
                  Add to Global
                </span>
                <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 12px;"></button>
              </div>
            </div>
          </div>

          <button class="btn btn-secondary" style="width: 100%; padding: 10px; font-size: 12px;">+ Add MCP Server</button>
        </div>

        </div>
      </div>
      
      <!-- Fixed Action Bar at Bottom -->
      <div style="display: flex; justify-content: space-between; padding: 16px 24px; border-top: 1px solid var(--border); background: var(--bg-secondary); flex-shrink: 0;">
        <button class="btn btn-secondary" onclick="showView('dashboard')">Cancel</button>
        <button class="btn btn-primary btn-pulse" onclick="showView('workspace')" style="display: flex; align-items: center; gap: 6px;">
          Create Project
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </div>
  <!-- ==================== WORKSPACE VIEW ==================== -->
  <div id="view-workspace" class="view view-workspace">
    <div class="workspace-container">
      <!-- Top Bar -->
      <div class="workspace-top-bar" id="workspace-top-bar">
        <div class="workspace-project-info">
          <span class="workspace-project-name">API Backend Optimization</span>
          <span class="workspace-location vps" style="display: inline-flex; align-items: center; gap: 4px;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
              <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
              <line x1="6" y1="6" x2="6.01" y2="6"></line>
              <line x1="6" y1="18" x2="6.01" y2="18"></line>
            </svg>
            VPS: prod-01 (192.168.1.104)
          </span>
        </div>
        
        <div style="width: 1px; height: 24px; background: var(--border); margin: 0 8px;"></div>
        
        <div class="connection-status connected" onclick="toggleConnection()" title="Click to disconnect">Connected</div>
        
        <div class="header-toggle-container">
          <button class="header-toggle" id="header-toggle-btn" onclick="toggleHeader()" title="Toggle header"></button>
        </div>
        
        <div class="model-selector" onclick="toggleModelDropdown()">
          <div class="model-selector-icon" style="background: #ef4444;"></div>
          <span class="model-selector-name">Claude Opus 4.5</span>
          <span></span>
          <div class="model-dropdown" id="model-dropdown">
            <div class="model-dropdown-section">Anthropic (Subscription)</div>
            <div class="model-dropdown-item active" onclick="selectModel(event, 'Claude Opus 4.5', '#ef4444')">Claude Opus 4.5</div>
            <div class="model-dropdown-item" onclick="selectModel(event, 'Claude Sonnet 4.5', '#ef4444')">Claude Sonnet 4.5</div>
            <div class="model-dropdown-item" onclick="selectModel(event, 'Claude 3.5 Sonnet', '#ef4444')">Claude 3.5 Sonnet</div>
            <div class="model-dropdown-item" onclick="selectModel(event, 'Claude 3 Opus', '#ef4444')">Claude 3 Opus</div>
            <div class="model-dropdown-item" onclick="selectModel(event, 'Claude 3 Haiku', '#ef4444')">Claude 3 Haiku</div>
            <div class="model-dropdown-section">OpenRouter (API Key Required)</div>
            <div class="model-dropdown-item" onclick="selectModel(event, 'GPT-4o', '#22c55e')" style="color: var(--text-muted);">GPT-4o <span style="font-size: 10px; background: var(--warning); color: #000; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">Paid</span></div>
            <div class="model-dropdown-item" onclick="selectModel(event, 'GPT-4 Turbo', '#22c55e')" style="color: var(--text-muted);">GPT-4 Turbo <span style="font-size: 10px; background: var(--warning); color: #000; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">Paid</span></div>
            <div class="model-dropdown-item" onclick="selectModel(event, 'GPT-5.2 Codex', '#22c55e')" style="color: var(--text-muted);">GPT-5.2 Codex <span style="font-size: 10px; background: var(--warning); color: #000; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">Paid</span></div>
            <div class="model-dropdown-item disabled" onclick="showView('settings')" style="cursor: pointer;">
              <span style="color: var(--primary);"> Add OpenRouter API Key...</span>
            </div>
            <div class="model-dropdown-section">Google (Coming Soon)</div>
            <div class="model-dropdown-item disabled">Gemini Pro  Coming Soon</div>
          </div>
        </div>

        <button class="export-btn">
           Export Project
        </button>
      </div>

      <div class="workspace-main">
        <!-- Icon Sidebar -->
        <div class="workspace-icon-bar">
          <div class="workspace-icon-btn active" id="workspaces-icon-btn" onclick="toggleFileExplorer()" title="Workspaces">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <div class="workspace-icon-btn" title="Search">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </div>
          <div class="workspace-icon-btn" title="Source Control">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="18" r="3"></circle>
              <circle cx="6" cy="6" r="3"></circle>
              <path d="M6 21V9a9 9 0 0 0 9 9"></path>
            </svg>
          </div>
          <div class="workspace-icon-btn" onclick="showView('create-project')" title="Create Project">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </div>
          <div style="flex: 1;"></div>
          <div class="workspace-icon-btn" onclick="showView('settings')" title="Settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
          </div>
        </div>

        <!-- Workspaces Panel (collapsible) -->
        <div id="file-explorer-panel" class="file-explorer">
          <div class="file-explorer-header">
            <span class="file-explorer-title">Workspaces</span>
            <div class="file-explorer-actions">
              <button title="Create Project" onclick="showView('create-project')" style="background: var(--primary); color: white; border-radius: 4px; font-size: 10px; padding: 4px;">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
              <button title="Collapse Panel" onclick="toggleFileExplorer()"></button>
            </div>
          </div>
          <div class="file-tree">
            <div class="file-tree-item folder" onclick="toggleTreeItem(this)">
              <span></span>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0;">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
              </svg>
              Customers
            </div>
            <div class="file-tree-children">
              <div class="file-tree-item active" style="background: rgba(59, 130, 246, 0.2); color: var(--primary);">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; opacity: 0.7;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                API Backend Optimization
              </div>
              <div class="file-tree-item">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; opacity: 0.7;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                Acme Corp Website
              </div>
              <div class="file-tree-item">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; opacity: 0.7;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                Beta Inc Dashboard
              </div>
            </div>
            <div class="file-tree-item folder" onclick="toggleTreeItem(this)">
              <span></span>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0;">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
              </svg>
              Personal
            </div>
            <div class="file-tree-item folder" onclick="toggleTreeItem(this)">
              <span></span>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; opacity: 0.6;">
                <polyline points="21 8 21 21 3 21 3 8"></polyline>
                <rect x="1" y="3" width="22" height="5"></rect>
                <line x1="10" y1="12" x2="14" y2="12"></line>
              </svg>
              Archives
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="workspace-content">
          <div class="workspace-panels">
            <!-- Chat Panel -->
            <div class="chat-panel" id="chat-panel">
              <div class="chat-messages">
                <div class="chat-message assistant">
                  <div class="avatar claude-avatar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                      <path d="M12 2L14.5 9H22L16 14L18.5 21L12 16.5L5.5 21L8 14L2 9H9.5L12 2Z" fill="currentColor"/>
                    </svg>
                  </div>
                  <div class="chat-message-content">
                    <p>I've updated the landing page hero section with the requested gradient and responsive typography. The preview on the right should reflect these changes instantly.</p>
                    
                    <div class="chat-code-block">
                      <div class="chat-code-header">
                        <span>COMPONENTS/HERO.TSX</span>
                        <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer;"></button>
                      </div>
                      <div class="chat-code-content">
<span class="keyword">export</span> <span class="keyword">const</span> <span class="const">Hero</span> = () <span class="keyword">=></span> (
  <span class="tag">&lt;section</span> <span class="attr">className</span>=<span class="string">"bg-gradient-to-r from-primary..."</span><span class="tag">&gt;</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="chat-message user">
                  <div class="bubble">Can you also add a dark mode toggle to the navigation bar?</div>
                </div>

                <div class="chat-message assistant">
                  <div class="avatar claude-avatar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                      <path d="M12 2L14.5 9H22L16 14L18.5 21L12 16.5L5.5 21L8 14L2 9H9.5L12 2Z" fill="currentColor"/>
                    </svg>
                  </div>
                  <div class="chat-message-content">
                    <div class="chat-status">
                      <div class="spinner"></div>
                      Updating <a href="#">nav.tsx</a> ... Reloading HMR...
                    </div>
                  </div>
                </div>
              </div>

              <div class="chat-input-area">
                <div class="chat-input-wrapper">
                  <span class="plus-btn"></span>
                  <input type="text" placeholder="Ask Claude to build something...">
                  <button class="mic-btn" onclick="toggleMic(this)" title="Voice input (Whisper)"></button>
                  <button class="send-btn"></button>
                </div>
                <div class="chat-input-hint"> Enter to send  Click  for voice input</div>
              </div>
            </div>

            <!-- Resizer between chat and preview -->
            <div class="resizer-vertical" id="resizer-chat-preview"></div>

            <!-- Preview Panel -->
            <div class="preview-panel collapsed" id="preview-panel">
              <button class="preview-toggle" onclick="togglePreview()" title="Expand preview"></button>
              <div class="preview-collapsed-bar">
                <span>Live Preview</span>
                <button onclick="togglePreview()" style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 4px; padding: 8px; color: var(--text-secondary); cursor: pointer;"></button>
              </div>
              <div class="preview-toolbar">
                <div class="preview-device-icons">
                  <button onclick="setPreviewDevice('phone', this)" title="Phone (375px)" class="device-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                      <line x1="12" y1="18" x2="12.01" y2="18"></line>
                    </svg>
                  </button>
                  <button onclick="setPreviewDevice('tablet', this)" title="Tablet (768px)" class="device-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                      <line x1="12" y1="18" x2="12.01" y2="18"></line>
                    </svg>
                  </button>
                  <button onclick="setPreviewDevice('desktop', this)" title="Desktop (1280px)" class="device-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                      <line x1="8" y1="21" x2="16" y2="21"></line>
                      <line x1="12" y1="17" x2="12" y2="21"></line>
                    </svg>
                  </button>
                  <button onclick="resetPreviewSize(this)" title="Fit to panel" class="device-btn active">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                    </svg>
                  </button>
                  <span id="device-size-label" style="font-size: 11px; color: var(--text-muted); margin-left: 4px;">Fit</span>
                </div>
                <div class="preview-dots">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
                <div class="preview-url">https://hubllm-live-preview-f2k9.hubllm.dev/</div>
                <div class="preview-actions">
                  <button title="Open in new tab">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                      <polyline points="15 3 21 3 21 9"></polyline>
                      <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                  </button>
                  <button title="Refresh" onclick="document.querySelector('.preview-frame').style.opacity='0.5'; setTimeout(() => document.querySelector('.preview-frame').style.opacity='1', 300)">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="23 4 23 10 17 10"></polyline>
                      <polyline points="1 20 1 14 7 14"></polyline>
                      <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="preview-frame-container">
                <div class="preview-frame" id="preview-frame" style="width: 100%; max-width: 100%;">
                  <div class="preview-demo">
                  <div class="preview-demo-logo"></div>
                  <h1>Build faster with <span>AI</span></h1>
                  <p>The ultimate workspace for developers looking to integrate LLMs into their production environment seamlessly.</p>
                  <div class="preview-demo-buttons">
                    <button class="primary">Get Started</button>
                    <button class="secondary">Documentation</button>
                  </div>
                </div>
              </div>
              </div>
            </div>
          </div>

          <!-- Resizer -->
          <div class="resizer" id="dev-panel-resizer"></div>

          <!-- LLM Dev Panel - VS Code Style -->
          <div class="llm-dev-panel" id="llm-dev-panel" style="height: 40px;">
            <div class="llm-dev-header" onclick="toggleDevPanel()">
              <div class="llm-dev-toggle">
                <span id="dev-panel-arrow"></span>
                LLM-Dev
              </div>
              <div class="llm-dev-tabs">
                <button class="active" onclick="event.stopPropagation(); showDevTab('terminal')">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;">
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" y1="19" x2="20" y2="19"></line>
                  </svg>
                  Terminal
                </button>
                <button onclick="event.stopPropagation(); showDevTab('docker')">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 4px; color: #2496ed;">
                    <path d="M13.983 11.078h2.119a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.119a.185.185 0 00-.185.185v1.888c0 .102.083.185.185.185m-2.954-5.43h2.118a.186.186 0 00.186-.186V3.574a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.186m0 2.716h2.118a.187.187 0 00.186-.186V6.29a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.887c0 .102.082.185.185.186m-2.93 0h2.12a.186.186 0 00.184-.186V6.29a.185.185 0 00-.185-.185H8.1a.185.185 0 00-.185.185v1.887c0 .102.083.185.185.186m-2.964 0h2.119a.186.186 0 00.185-.186V6.29a.185.185 0 00-.185-.185H5.136a.186.186 0 00-.186.185v1.887c0 .102.084.185.186.186m5.893 2.715h2.118a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.185m-2.93 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.083.185.185.185m-2.964 0h2.119a.185.185 0 00.185-.185V9.006a.185.185 0 00-.185-.186h-2.119a.185.185 0 00-.185.185v1.888c0 .102.083.185.185.185m-2.92 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.186.186 0 00-.185.185v1.888c0 .102.084.185.185.185M23.763 9.89c-.065-.051-.672-.51-1.954-.51-.338.001-.676.03-1.01.087-.248-1.7-1.653-2.53-1.716-2.566l-.344-.199-.226.327c-.284.438-.49.922-.612 1.43-.23.97-.09 1.882.403 2.661-.595.332-1.55.413-1.744.42H.751a.751.751 0 00-.75.748 11.376 11.376 0 00.692 4.062c.545 1.428 1.355 2.48 2.41 3.124 1.18.723 3.1 1.137 5.275 1.137.983.003 1.963-.086 2.93-.266a12.248 12.248 0 003.823-1.389c.98-.567 1.86-1.288 2.61-2.136 1.252-1.418 1.998-2.997 2.553-4.4h.221c1.372 0 2.215-.549 2.68-1.009.309-.293.55-.65.707-1.046l.098-.288z"/>
                  </svg>
                  Docker
                </button>
                <button onclick="event.stopPropagation(); showDevTab('logs')">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                  </svg>
                  Logs
                </button>
                <button onclick="event.stopPropagation(); showDevTab('prompt')">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                  </svg>
                  Project Context
                </button>
              </div>
              <div class="llm-dev-status">
                <span class="server"> prod-01 (192.168.1.104)</span>
                <span>Tokens: 14.2k</span>
                <span>UTF-8</span>
              </div>
            </div>
            <div id="dev-panel-content" class="llm-dev-content" style="display: none;">
              <!-- File Explorer -->
              <div class="dev-file-explorer" id="dev-file-explorer">
                <div class="dev-file-explorer-header">
                  <span>Explorer</span>
                  <div style="display: flex; gap: 2px;">
                    <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 11px; padding: 2px 4px; border-radius: 3px;" title="Go to Home Directory" onclick="alert('Navigate to home')"></button>
                    <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 11px; padding: 2px 4px; border-radius: 3px;" title="Go Up One Level" onclick="alert('Navigate up')"></button>
                    <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; border-radius: 3px;" title="Go Back" onclick="alert('Navigate back')">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                      </svg>
                    </button>
                    <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; border-radius: 3px;" title="Go Forward" onclick="alert('Navigate forward')">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                      </svg>
                    </button>
                    <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; border-radius: 3px;" title="Refresh" onclick="alert('Refresh')">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                      </svg>
                    </button>
                  </div>
                </div>
                <div style="display: flex; gap: 4px; padding: 4px 8px; border-bottom: 1px solid var(--border);">
                  <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; border-radius: 3px;" title="New File">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                      <line x1="12" y1="18" x2="12" y2="12"></line>
                      <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                  </button>
                  <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; border-radius: 3px;" title="New Folder">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                      <line x1="12" y1="11" x2="12" y2="17"></line>
                      <line x1="9" y1="14" x2="15" y2="14"></line>
                    </svg>
                  </button>
                  <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; border-radius: 3px;" title="Collapse All">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="4 14 10 14 10 20"></polyline>
                      <polyline points="20 10 14 10 14 4"></polyline>
                      <line x1="14" y1="10" x2="21" y2="3"></line>
                      <line x1="3" y1="21" x2="10" y2="14"></line>
                    </svg>
                  </button>
                </div>
                <div style="padding: 4px 8px; font-size: 11px; color: var(--text-muted); background: var(--bg-tertiary); border-bottom: 1px solid var(--border);">
                  ~/projects/api-backend
                </div>
                <div class="dev-file-tree" style="border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 8px;">
                  <div class="dev-file-item folder" style="font-weight: 500;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #e8a838;">
                      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    src
                  </div>
                  <div class="dev-file-children">
                    <div class="dev-file-item">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #f7df1e;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                      </svg>
                      index.js
                    </div>
                    <div class="dev-file-item active">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #f7df1e;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                      </svg>
                      server.js
                    </div>
                    <div class="dev-file-item">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #f7df1e;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                      </svg>
                      routes.js
                    </div>
                  </div>
                  <div class="dev-file-item">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #cb3837;">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    package.json
                  </div>
                  <div class="dev-file-item">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #519aba;">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    README.md
                  </div>
                </div>
                <div class="dev-file-explorer-header" style="border-bottom: none; padding-top: 0;">
                  <span>Open Editors</span>
                  <button style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 2px;">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
                <div class="dev-file-tree">
                  <div class="dev-file-item active">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #f7df1e;">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    server.js
                  </div>
                  <div class="dev-file-item">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #f7df1e;">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    routes.js
                  </div>
                </div>
              </div>

              <!-- Resizer between explorer and editor -->
              <div class="resizer-vertical" id="resizer-explorer"></div>

              <!-- Editor Area -->
              <div class="dev-editor-area" id="dev-editor-area">
                <div class="dev-editor-tabs">
                  <div class="dev-editor-tab active">
                    <span>server.js</span>
                    <span class="close"></span>
                  </div>
                  <div class="dev-editor-tab">
                    <span>routes.js</span>
                    <span class="close"></span>
                  </div>
                </div>
                <div class="dev-editor-content">
                  <div><span class="line-number">1</span><span class="keyword">const</span> express = <span class="keyword">require</span>(<span class="string">'express'</span>);</div>
                  <div><span class="line-number">2</span><span class="keyword">const</span> app = express();</div>
                  <div><span class="line-number">3</span></div>
                  <div><span class="line-number">4</span>app.<span class="keyword">get</span>(<span class="string">'/'</span>, (req, res) => {</div>
                  <div><span class="line-number">5</span>  res.<span class="keyword">send</span>(<span class="string">'Hello World!'</span>);</div>
                  <div><span class="line-number">6</span>});</div>
                  <div><span class="line-number">7</span></div>
                  <div><span class="line-number">8</span>app.<span class="keyword">listen</span>(<span class="const">3000</span>);</div>
                </div>
              </div>

              <!-- Resizer between editor and terminal -->
              <div class="resizer-vertical" id="resizer-terminal"></div>

              <!-- Terminal Area -->
              <div class="dev-terminal-area" id="dev-terminal-area">
                <div class="dev-terminal-tabs">
                  <div class="dev-terminal-tab active">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;">
                      <polyline points="4 17 10 11 4 5"></polyline>
                      <line x1="12" y1="19" x2="20" y2="19"></line>
                    </svg>
                    Terminal
                  </div>
                  <div class="dev-terminal-tab">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px;">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    Output
                  </div>
                  <div class="dev-terminal-tab">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 4px; color: #f97316;">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="12"></line>
                      <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    Problems
                  </div>
                  <button style="margin-left: auto; background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                  </button>
                </div>
                <div class="dev-terminal-content">
                  <div class="terminal-line">
                    <span class="prompt">user@prod-01:~$</span> <span class="command">npm run dev</span>
                  </div>
                  <div class="terminal-line">
                    <span class="output">&gt; api-backend@1.0.0 dev</span>
                  </div>
                  <div class="terminal-line">
                    <span class="output">&gt; node server.js</span>
                  </div>
                  <div class="terminal-line">
                    <span class="success"> Server running on port 3000</span>
                  </div>
                  <div class="terminal-line">
                    <span class="output">Watching for file changes...</span>
                  </div>
                  <div class="terminal-line">
                    <span class="prompt">user@prod-01:~$</span> <span style="animation: blink 1s infinite;"></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Docker Tab Content (hidden) -->
            <div id="tab-docker-content" class="llm-dev-content" style="display: none;">
              <div style="padding: 16px; width: 100%;">
                <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                  <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;"> Refresh</button>
                  <button class="btn btn-primary" style="padding: 8px 12px; font-size: 12px;"> Start All</button>
                </div>
                <div style="background: var(--bg-tertiary); border-radius: 8px; overflow: hidden;">
                  <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 8px 16px; font-size: 12px; font-weight: 600; color: var(--text-secondary); border-bottom: 1px solid var(--border);">
                    <span>CONTAINER</span>
                    <span>IMAGE</span>
                    <span>STATUS</span>
                    <span>ACTIONS</span>
                  </div>
                  <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 12px 16px; font-size: 13px; align-items: center;">
                    <span>api-backend-db-1</span>
                    <span style="color: var(--text-secondary);">postgres:15</span>
                    <span style="color: var(--success);"> Running</span>
                    <span><button style="background: none; border: none; cursor: pointer;"></button></span>
                  </div>
                  <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 12px 16px; font-size: 13px; align-items: center; border-top: 1px solid var(--border);">
                    <span>api-backend-redis-1</span>
                    <span style="color: var(--text-secondary);">redis:7</span>
                    <span style="color: var(--success);"> Running</span>
                    <span><button style="background: none; border: none; cursor: pointer;"></button></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Logs Tab Content (hidden) -->
            <div id="tab-logs-content" class="llm-dev-content" style="display: none;">
              <div style="padding: 16px; width: 100%; font-family: Monaco, Consolas, monospace; font-size: 12px;">
                <div style="margin-bottom: 4px; color: var(--text-muted);">[2025-01-22 10:23:45] INFO: Server started</div>
                <div style="margin-bottom: 4px; color: var(--text-muted);">[2025-01-22 10:23:46] INFO: Database connected</div>
                <div style="margin-bottom: 4px; color: var(--success);">[2025-01-22 10:23:47] INFO: Ready to accept connections</div>
                <div style="margin-bottom: 4px; color: var(--text-muted);">[2025-01-22 10:24:12] INFO: GET / - 200 - 12ms</div>
                <div style="margin-bottom: 4px; color: var(--text-muted);">[2025-01-22 10:24:15] INFO: GET /api/users - 200 - 45ms</div>
                <div style="margin-bottom: 4px; color: var(--warning);">[2025-01-22 10:24:20] WARN: Slow query detected (>100ms)</div>
              </div>
            </div>

            <!-- Project Context Tab Content (hidden) -->
            <div id="tab-prompt-content" class="llm-dev-content" style="display: none;">
              <div style="padding: 16px; width: 100%; overflow-y: auto; max-height: calc(100% - 40px);">
                
                <!-- Current Model & Auto-generated Files -->
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span style="font-size: 12px; color: var(--text-secondary);">Current Model:</span>
                      <span style="font-weight: 500;">Claude Opus 4.5</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span style="font-size: 11px; background: rgba(34, 197, 94, 0.2); color: var(--success); padding: 2px 8px; border-radius: 4px;">CLAUDE.md </span>
                      <span style="font-size: 11px; background: rgba(34, 197, 94, 0.2); color: var(--success); padding: 2px 8px; border-radius: 4px;">.claude/agents/ </span>
                    </div>
                  </div>
                </div>

                <!-- Project Description -->
                <div style="margin-bottom: 16px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;">Project Context</span>
                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 11px;">Edit</button>
                  </div>
                  <div style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 12px; font-family: Monaco, Consolas, monospace; font-size: 12px; color: var(--text-primary); max-height: 120px; overflow-y: auto;">
                    <div style="color: var(--text-muted);"># API Backend Optimization</div>
                    <div style="margin-top: 8px;"><span style="color: var(--accent);">Tech:</span> Node.js, Express, PostgreSQL, Redis</div>
                    <div style="margin-top: 4px;"><span style="color: var(--accent);">Standards:</span> TypeScript strict, async/await, JSDoc</div>
                    <div style="margin-top: 8px; color: var(--text-muted);">## Commands</div>
                    <div>npm run dev  Start dev server</div>
                    <div>npm test  Run tests</div>
                    <div>npm run lint  ESLint check</div>
                  </div>
                </div>

                <!-- Project Agents -->
                <div style="margin-bottom: 16px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;">Agents</span>
                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 11px;">+ Add</button>
                  </div>
                  
                  <!-- Project-specific agents -->
                  <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px;">PROJECT-SPECIFIC</div>
                  <div style="background: var(--bg-tertiary); border-radius: 6px; padding: 8px 10px; margin-bottom: 6px; display: flex; align-items: center; gap: 8px;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">api-designer</div>
                      <div style="font-size: 10px; color: var(--text-muted);">Designs REST API endpoints</div>
                    </div>
                    <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 10px;">Edit</button>
                  </div>
                  <div style="background: var(--bg-tertiary); border-radius: 6px; padding: 8px 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">db-optimizer</div>
                      <div style="font-size: 10px; color: var(--text-muted);">Optimizes database queries</div>
                    </div>
                    <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 10px;">Edit</button>
                  </div>
                  
                  <!-- Inherited global agents -->
                  <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px;">INHERITED FROM GLOBAL</div>
                  <div style="background: var(--bg-secondary); border: 1px dashed var(--border); border-radius: 6px; padding: 8px 10px; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; opacity: 0.7;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">code-reviewer <span style="font-size: 9px; color: var(--text-muted);">(global)</span></div>
                    </div>
                    <button style="background: none; border: none; color: var(--primary); cursor: pointer; font-size: 10px;">Override</button>
                  </div>
                  <div style="background: var(--bg-secondary); border: 1px dashed var(--border); border-radius: 6px; padding: 8px 10px; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; opacity: 0.7;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">security-audit <span style="font-size: 9px; color: var(--text-muted);">(global)</span></div>
                    </div>
                    <button style="background: none; border: none; color: var(--primary); cursor: pointer; font-size: 10px;">Override</button>
                  </div>
                  <div style="background: var(--bg-secondary); border: 1px dashed var(--border); border-radius: 6px; padding: 8px 10px; display: flex; align-items: center; gap: 8px; opacity: 0.7;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">test-writer <span style="font-size: 9px; color: var(--text-muted);">(global)</span></div>
                    </div>
                    <button style="background: none; border: none; color: var(--primary); cursor: pointer; font-size: 10px;">Override</button>
                  </div>
                </div>

                <!-- MCP Servers -->
                <div style="margin-bottom: 16px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;">MCP Servers</span>
                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 11px;">+ Add</button>
                  </div>
                  
                  <!-- Project-specific MCP -->
                  <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px;">PROJECT-SPECIFIC</div>
                  <div style="background: var(--bg-tertiary); border-radius: 6px; padding: 8px 10px; margin-bottom: 6px; display: flex; align-items: center; gap: 8px;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">PostgreSQL</div>
                      <div style="font-size: 10px; color: var(--success);"> Connected</div>
                    </div>
                    <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 10px;">Configure</button>
                  </div>
                  <div style="background: var(--bg-tertiary); border-radius: 6px; padding: 8px 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">Redis</div>
                      <div style="font-size: 10px; color: var(--success);"> Connected</div>
                    </div>
                    <button style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 10px;">Configure</button>
                  </div>
                  
                  <!-- Inherited global MCP -->
                  <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px;">INHERITED FROM GLOBAL</div>
                  <div style="background: var(--bg-secondary); border: 1px dashed var(--border); border-radius: 6px; padding: 8px 10px; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; opacity: 0.7;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">GitHub <span style="font-size: 9px; color: var(--text-muted);">(global)</span></div>
                    </div>
                    <span style="font-size: 10px; color: var(--success);"></span>
                  </div>
                  <div style="background: var(--bg-secondary); border: 1px dashed var(--border); border-radius: 6px; padding: 8px 10px; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; opacity: 0.7;">
                    <span></span>
                    <div style="flex: 1;">
                      <div style="font-size: 12px; font-weight: 500;">Slack <span style="font-size: 9px; color: var(--text-muted);">(global)</span></div>
                    </div>
                    <span style="font-size: 10px; color: var(--success);"></span>
                  </div>
                </div>

                <!-- Regenerate Button -->
                <div style="padding-top: 12px; border-top: 1px solid var(--border);">
                  <button class="btn btn-secondary" style="width: 100%; padding: 10px; font-size: 12px;">
                     Regenerate Config Files (CLAUDE.md)
                  </button>
                  <div style="font-size: 10px; color: var(--text-muted); text-align: center; margin-top: 6px;">
                    Auto-converts to correct format when you switch LLMs
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Model Selection Notification Modal -->
  <div class="model-notification-overlay" id="model-notification-overlay" onclick="hideModelNotification()"></div>
  <div class="model-notification" id="model-notification">
    <div class="model-notification-header">
      <div class="model-notification-icon" id="model-notification-icon" style="background: rgba(249, 115, 22, 0.2);"></div>
      <div class="model-notification-title" id="model-notification-title">Using OpenRouter API Key</div>
    </div>
    <div class="model-notification-body" id="model-notification-body">
      You're selecting a model that will use your OpenRouter API key.
    </div>
    <div class="model-notification-actions">
      <button class="btn btn-secondary" onclick="hideModelNotification()">Cancel</button>
      <button class="btn btn-primary" id="model-notification-confirm">Confirm</button>
    </div>
  </div>

  <!-- ==================== CREATE/EDIT AGENT MODAL ==================== -->
  <div class="modal-overlay" id="agent-modal-overlay" onclick="hideAgentModal()"></div>
  <div class="modal" id="agent-modal">
    <div class="modal-header">
      <h3 id="agent-modal-title">Create New Agent</h3>
      <button class="modal-close" onclick="hideAgentModal()"></button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Agent Name</label>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="color: var(--text-muted);">@</span>
          <input type="text" id="agent-name" class="model-select" style="flex: 1;" placeholder="e.g. api-designer">
        </div>
        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Invoke with @agent-name in chat</div>
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Icon</label>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button onclick="selectAgentIcon(this, '')" class="icon-picker selected" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--primary); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectAgentIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectAgentIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectAgentIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectAgentIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectAgentIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectAgentIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectAgentIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
        </div>
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Description</label>
        <input type="text" id="agent-description" class="model-select" style="width: 100%;" placeholder="e.g. Designs REST API endpoints following best practices">
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
        <div>
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Model</label>
          <select id="agent-model" class="model-select" style="width: 100%;">
            <option value="sonnet">Claude Sonnet 4.5 (Fast)</option>
            <option value="opus">Claude Opus 4.5 (Powerful)</option>
            <option value="haiku">Claude Haiku 4.5 (Quick)</option>
          </select>
        </div>
        <div>
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Tools Access</label>
          <select id="agent-tools" class="model-select" style="width: 100%;">
            <option value="readonly">Read-only (safer)</option>
            <option value="all">All tools (can edit files)</option>
            <option value="none">No tools (chat only)</option>
          </select>
        </div>
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">System Prompt (Optional)</label>
        <textarea id="agent-prompt" class="model-select" style="width: 100%; min-height: 100px; font-size: 13px;" placeholder="Custom instructions for this agent...

Example: You are an expert API designer. When asked to design endpoints, always consider REST best practices, proper HTTP methods, and clear naming conventions."></textarea>
      </div>

      <div style="padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; margin-bottom: 16px;">
        <div style="font-size: 12px; color: var(--text-secondary);">
          <strong> Tip:</strong> This agent will be auto-converted to the correct format (CLAUDE.md agents, Codex skills, or system prompts) based on which LLM you use in each project.
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="hideAgentModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveAgent()">
        <span id="agent-save-text">Create Agent</span>
      </button>
    </div>
  </div>

  <!-- ==================== CREATE/EDIT SKILL MODAL ==================== -->
  <div class="modal-overlay" id="skill-modal-overlay" onclick="hideSkillModal()"></div>
  <div class="modal" id="skill-modal">
    <div class="modal-header">
      <h3 id="skill-modal-title">Create New Skill</h3>
      <button class="modal-close" onclick="hideSkillModal()"></button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Skill Name</label>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="color: var(--text-muted);">$</span>
          <input type="text" id="skill-name" class="model-select" style="flex: 1;" placeholder="e.g. doc-generator">
        </div>
        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Invoke with $skill-name or automatically when relevant</div>
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Icon</label>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button onclick="selectSkillIcon(this, '')" class="icon-picker selected" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--primary); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectSkillIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectSkillIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectSkillIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectSkillIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
          <button onclick="selectSkillIcon(this, '')" class="icon-picker" style="width: 36px; height: 36px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg-tertiary); font-size: 18px; cursor: pointer;"></button>
        </div>
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Description</label>
        <input type="text" id="skill-description" class="model-select" style="width: 100%;" placeholder="e.g. Generates documentation from code including README and API docs">
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Skill Instructions (SKILL.md content)</label>
        <textarea id="skill-content" class="model-select" style="width: 100%; min-height: 150px; font-family: Monaco, Consolas, monospace; font-size: 12px;" placeholder="# Doc Generator Skill

## When to use
Use this skill when the user asks to generate documentation.

## Steps
1. Analyze the code structure
2. Extract function signatures and comments
3. Generate markdown documentation

## Output format
- README.md for project overview
- API.md for endpoint documentation"></textarea>
      </div>

      <div style="padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; margin-bottom: 16px;">
        <div style="font-size: 12px; color: var(--text-secondary);">
          <strong> Tip:</strong> Skills teach the AI specific workflows. They're automatically loaded when relevant or invoked with <code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">$skill-name</code>.
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="hideSkillModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveSkill()">
        <span id="skill-save-text">Create Skill</span>
      </button>
    </div>
  </div>

  <!-- ==================== CREATE/EDIT MCP SERVER MODAL ==================== -->
  <div class="modal-overlay" id="mcp-modal-overlay" onclick="hideMCPModal()"></div>
  <div class="modal" id="mcp-modal">
    <div class="modal-header">
      <h3 id="mcp-modal-title">Add MCP Server</h3>
      <button class="modal-close" onclick="hideMCPModal()"></button>
    </div>
    <div class="modal-body">
      <!-- Server Type Selection -->
      <div style="margin-bottom: 20px;">
        <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 12px;">Server Type</label>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
          <div onclick="selectMCPType(this, 'database')" class="mcp-type-option selected" style="padding: 12px; background: var(--bg-tertiary); border: 2px solid var(--primary); border-radius: 8px; cursor: pointer; text-align: center;">
            <div style="width: 32px; height: 32px; margin: 0 auto 6px; display: flex; align-items: center; justify-content: center;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary);">
                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
              </svg>
            </div>
            <div style="font-size: 11px; font-weight: 500;">Database</div>
          </div>
          <div onclick="selectMCPType(this, 'api')" class="mcp-type-option" style="padding: 12px; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 8px; cursor: pointer; text-align: center;">
            <div style="width: 32px; height: 32px; margin: 0 auto 6px; display: flex; align-items: center; justify-content: center;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--text-secondary);">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
              </svg>
            </div>
            <div style="font-size: 11px; font-weight: 500;">API/Service</div>
          </div>
          <div onclick="selectMCPType(this, 'custom')" class="mcp-type-option" style="padding: 12px; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 8px; cursor: pointer; text-align: center;">
            <div style="width: 32px; height: 32px; margin: 0 auto 6px; display: flex; align-items: center; justify-content: center;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--text-secondary);">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
              </svg>
            </div>
            <div style="font-size: 11px; font-weight: 500;">Custom</div>
          </div>
        </div>
      </div>

      <!-- Database Options -->
      <div id="mcp-database-options">
        <div style="margin-bottom: 16px;">
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Database Type</label>
          <select id="mcp-db-type" class="model-select" style="width: 100%;" onchange="updateMCPIcon()">
            <option value="postgres"> PostgreSQL</option>
            <option value="mysql"> MySQL</option>
            <option value="mongodb"> MongoDB</option>
            <option value="redis"> Redis</option>
            <option value="sqlite"> SQLite</option>
          </select>
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Connection String</label>
          <input type="text" id="mcp-connection" class="model-select" style="width: 100%; font-family: Monaco, Consolas, monospace; font-size: 12px;" placeholder="postgresql://user:password@localhost:5432/dbname">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
          <div>
            <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Display Name</label>
            <input type="text" id="mcp-name" class="model-select" style="width: 100%;" placeholder="e.g. Production DB">
          </div>
          <div>
            <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Access Level</label>
            <select id="mcp-access" class="model-select" style="width: 100%;">
              <option value="readonly">Read-only (safer)</option>
              <option value="readwrite">Read & Write</option>
            </select>
          </div>
        </div>
      </div>

      <!-- API/Service Options (hidden by default) -->
      <div id="mcp-api-options" style="display: none;">
        <div style="margin-bottom: 16px;">
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Service</label>
          <select id="mcp-service" class="model-select" style="width: 100%;">
            <option value="github"> GitHub</option>
            <option value="slack"> Slack</option>
            <option value="gdrive"> Google Drive</option>
            <option value="notion"> Notion</option>
            <option value="jira"> Jira</option>
            <option value="linear"> Linear</option>
          </select>
        </div>
        <div style="margin-bottom: 16px;">
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">API Token / OAuth</label>
          <input type="password" id="mcp-token" class="model-select" style="width: 100%;" placeholder="Enter API token or click Connect to OAuth">
          <button class="btn btn-secondary" style="margin-top: 8px; padding: 8px 16px; font-size: 12px;"> Connect with OAuth</button>
        </div>
      </div>

      <!-- Custom Options (hidden by default) -->
      <div id="mcp-custom-options" style="display: none;">
        <div style="margin-bottom: 16px;">
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Server Command</label>
          <input type="text" id="mcp-command" class="model-select" style="width: 100%; font-family: Monaco, Consolas, monospace; font-size: 12px;" placeholder="npx @modelcontextprotocol/server-filesystem">
        </div>
        <div style="margin-bottom: 16px;">
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Arguments (JSON)</label>
          <textarea id="mcp-args" class="model-select" style="width: 100%; min-height: 80px; font-family: Monaco, Consolas, monospace; font-size: 12px;" placeholder='["--directory", "/path/to/files"]'></textarea>
        </div>
        <div style="margin-bottom: 16px;">
          <label style="display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px;">Display Name</label>
          <input type="text" id="mcp-custom-name" class="model-select" style="width: 100%;" placeholder="e.g. File System Access">
        </div>
      </div>

      <div style="padding: 12px; background: rgba(249, 115, 22, 0.1); border: 1px solid var(--accent); border-radius: 8px;">
        <div style="font-size: 12px; color: var(--accent);">
          <strong> Security Note:</strong> MCP servers have direct access to your data. Only connect to trusted sources and use read-only access when possible.
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="hideMCPModal()">Cancel</button>
      <div style="display: flex; gap: 8px;">
        <button class="btn btn-secondary" onclick="testMCPConnection()"> Test Connection</button>
        <button class="btn btn-primary" onclick="saveMCP()">
          <span id="mcp-save-text">Add Server</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Model dropdown
    function toggleModelDropdown() {
      const dropdown = document.getElementById('model-dropdown');
      dropdown.classList.toggle('open');
    }

    function selectModel(event, modelName, color) {
      event.stopPropagation();
      
      // Define which provider each model belongs to
      const modelProviders = {
        // Anthropic models (subscription)
        'Claude Opus 4.5': { provider: 'anthropic', keyType: 'subscription' },
        'Claude Sonnet 4.5': { provider: 'anthropic', keyType: 'subscription' },
        'Claude 3.5 Sonnet': { provider: 'anthropic', keyType: 'subscription' },
        'Claude 3 Opus': { provider: 'anthropic', keyType: 'subscription' },
        'Claude 3 Haiku': { provider: 'anthropic', keyType: 'subscription' },
        // OpenAI models (OpenRouter or direct key in future)
        'GPT-4o': { provider: 'openai', keyType: 'openrouter', directKeyAvailable: false },
        'GPT-4 Turbo': { provider: 'openai', keyType: 'openrouter', directKeyAvailable: false },
        'GPT-5.2 Codex': { provider: 'openai', keyType: 'openrouter', directKeyAvailable: false },
        // Google models (OpenRouter or direct key in future)
        'Gemini Pro': { provider: 'google', keyType: 'openrouter', directKeyAvailable: false },
        'Gemini Ultra': { provider: 'google', keyType: 'openrouter', directKeyAvailable: false },
      };
      
      // Simulated user keys (in real app, this would come from settings)
      const userKeys = {
        anthropicSubscription: true,
        openRouterKey: true,  // User has OpenRouter key
        openAIKey: false,     // User does NOT have direct OpenAI key (future feature)
        googleKey: false,     // User does NOT have direct Google key (future feature)
      };
      
      const modelInfo = modelProviders[modelName];
      
      // If it's an Anthropic model, just select it (included in subscription)
      if (modelInfo && modelInfo.provider === 'anthropic') {
        applyModelSelection(modelName, color);
        return;
      }
      
      // For non-Anthropic models, show notification
      if (modelInfo && modelInfo.provider !== 'anthropic') {
        // Check if direct key is available for this provider
        const hasDirectKey = (modelInfo.provider === 'openai' && userKeys.openAIKey) ||
                            (modelInfo.provider === 'google' && userKeys.googleKey);
        
        // Future: When direct keys are supported, show choice dialog
        if (modelInfo.directKeyAvailable && hasDirectKey && userKeys.openRouterKey) {
          // Show choice dialog between direct key and OpenRouter
          showModelKeyChoice(modelName, color, modelInfo.provider);
        } else if (userKeys.openRouterKey) {
          // Only OpenRouter available - show notification
          showModelNotification(modelName, color, 'openrouter');
        } else {
          // No key available - prompt to add key
          showModelNotification(modelName, color, 'nokey');
        }
        return;
      }
      
      // Default: just apply selection
      applyModelSelection(modelName, color);
    }
    
    // Apply the model selection to UI
    function applyModelSelection(modelName, color) {
      const selector = document.querySelector('.model-selector');
      selector.querySelector('.model-selector-name').textContent = modelName;
      selector.querySelector('.model-selector-icon').style.background = color;
      
      // Update active state
      document.querySelectorAll('.model-dropdown-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // Close dropdown
      document.getElementById('model-dropdown').classList.remove('open');
    }
    
    // Show notification about which API key is being used
    function showModelNotification(modelName, color, keyType) {
      const overlay = document.getElementById('model-notification-overlay');
      const modal = document.getElementById('model-notification');
      const title = document.getElementById('model-notification-title');
      const body = document.getElementById('model-notification-body');
      const icon = document.getElementById('model-notification-icon');
      const confirmBtn = document.getElementById('model-notification-confirm');
      
      if (keyType === 'openrouter') {
        icon.style.background = 'rgba(249, 115, 22, 0.2)';
        icon.textContent = '';
        title.textContent = 'Using OpenRouter API Key';
        body.innerHTML = `
          <p>You're selecting <strong>${modelName}</strong> which will use your <strong>OpenRouter API key</strong>.</p>
          <p style="margin-top: 12px; padding: 10px; background: rgba(234, 179, 8, 0.1); border-radius: 6px; border-left: 3px solid var(--warning);">
            <strong> Note:</strong> This is a paid feature. Usage will be billed to your OpenRouter account.
          </p>
        `;
        confirmBtn.textContent = 'Use OpenRouter';
        confirmBtn.onclick = function() {
          hideModelNotification();
          applyModelSelection(modelName, color);
        };
      } else if (keyType === 'nokey') {
        icon.style.background = 'rgba(239, 68, 68, 0.2)';
        icon.textContent = '';
        title.textContent = 'API Key Required';
        body.innerHTML = `
          <p>To use <strong>${modelName}</strong>, you need to add an OpenRouter API key in Settings.</p>
          <p style="margin-top: 12px;">OpenRouter provides access to multiple AI models with a single API key.</p>
        `;
        confirmBtn.textContent = 'Go to Settings';
        confirmBtn.onclick = function() {
          hideModelNotification();
          showView('settings');
        };
      }
      
      overlay.classList.add('show');
      modal.classList.add('show');
      document.getElementById('model-dropdown').classList.remove('open');
    }
    
    // Show choice dialog when multiple keys are available (future feature)
    function showModelKeyChoice(modelName, color, provider) {
      const overlay = document.getElementById('model-notification-overlay');
      const modal = document.getElementById('model-notification');
      const title = document.getElementById('model-notification-title');
      const body = document.getElementById('model-notification-body');
      const icon = document.getElementById('model-notification-icon');
      const confirmBtn = document.getElementById('model-notification-confirm');
      
      const providerNames = {
        'openai': 'OpenAI',
        'google': 'Google'
      };
      
      icon.style.background = 'rgba(59, 130, 246, 0.2)';
      icon.textContent = '';
      title.textContent = 'Choose API Key';
      body.innerHTML = `
        <p>You have multiple ways to access <strong>${modelName}</strong>. Which API key would you like to use?</p>
        <div class="model-notification-choice" style="margin-top: 16px;">
          <div class="model-choice-option selected" onclick="selectKeyOption(this, 'direct')">
            <div class="model-choice-radio"></div>
            <div>
              <div style="font-weight: 500;">${providerNames[provider]} Direct Key</div>
              <div style="font-size: 12px; color: var(--text-muted);">Use your ${providerNames[provider]} API key directly</div>
            </div>
          </div>
          <div class="model-choice-option" onclick="selectKeyOption(this, 'openrouter')">
            <div class="model-choice-radio"></div>
            <div>
              <div style="font-weight: 500;">OpenRouter</div>
              <div style="font-size: 12px; color: var(--text-muted);">Route through OpenRouter (unified billing)</div>
            </div>
          </div>
        </div>
      `;
      
      confirmBtn.textContent = 'Confirm Selection';
      confirmBtn.onclick = function() {
        const selectedOption = document.querySelector('.model-choice-option.selected');
        const keyType = selectedOption ? selectedOption.getAttribute('data-key') || 'direct' : 'direct';
        hideModelNotification();
        applyModelSelection(modelName, color);
        // In real app, store the key preference
        console.log(`Selected ${modelName} with ${keyType} key`);
      };
      
      overlay.classList.add('show');
      modal.classList.add('show');
      document.getElementById('model-dropdown').classList.remove('open');
    }
    
    // Toggle key option selection
    function selectKeyOption(element, keyType) {
      document.querySelectorAll('.model-choice-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      element.classList.add('selected');
      element.setAttribute('data-key', keyType);
    }
    
    // Hide the notification modal
    function hideModelNotification() {
      document.getElementById('model-notification-overlay').classList.remove('show');
      document.getElementById('model-notification').classList.remove('show');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.model-selector')) {
        document.getElementById('model-dropdown')?.classList.remove('open');
      }
    });

    // Header toggle
    let headerCollapsed = false;
    function toggleHeader() {
      headerCollapsed = !headerCollapsed;
      const topBar = document.getElementById('workspace-top-bar');
      const toggleBtn = document.getElementById('header-toggle-btn');
      
      if (headerCollapsed) {
        topBar.classList.add('collapsed');
        toggleBtn.textContent = '';
        toggleBtn.title = 'Expand header';
      } else {
        topBar.classList.remove('collapsed');
        toggleBtn.textContent = '';
        toggleBtn.title = 'Collapse header';
      }
    }

    // View switching
    function showView(viewName) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById('view-' + viewName).classList.add('active');
      
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.textContent.toLowerCase().replace(' ', '-') === viewName) {
          tab.classList.add('active');
        }
      });
    }

    // Connection type selection
    function selectConnection(element, type) {
      document.querySelectorAll('.connection-option').forEach(opt => {
        opt.style.borderColor = 'var(--border)';
        opt.classList.remove('selected');
      });
      element.style.borderColor = 'var(--primary)';
      element.classList.add('selected');
    }

    // Toggle VPS card expansion
    let vpsExpanded = false;
    function toggleVPSCard() {
      vpsExpanded = !vpsExpanded;
      const fields = document.getElementById('fields-vps');
      const icon = document.getElementById('vps-toggle-icon');
      const card = document.getElementById('vps-card');
      
      if (vpsExpanded) {
        fields.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
        card.style.borderColor = 'var(--primary)';
      } else {
        fields.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
        card.style.borderColor = 'var(--border)';
      }
    }

    // Connect GitHub OAuth
    function connectGitHub() {
      const btn = event.target.closest('button');
      const originalHTML = btn.innerHTML;
      
      btn.innerHTML = `
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;">
          <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
        </svg>
        Connecting...
      `;
      btn.disabled = true;
      
      // Simulate OAuth flow (in real app, this would open GitHub OAuth)
      // window.open('https://github.com/login/oauth/authorize?client_id=xxx&scope=repo,codespace', '_blank');
      
      setTimeout(() => {
        // Simulate successful OAuth
        document.getElementById('github-not-connected').style.display = 'none';
        document.getElementById('github-connected').style.display = 'block';
      }, 1500);
    }

    // Test VPS Connection
    function testVPSConnection() {
      const btn = event.target.closest('button');
      const originalHTML = btn.innerHTML;
      
      btn.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;">
          <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
        </svg>
        Testing...
      `;
      btn.disabled = true;
      
      // Simulate connection test
      setTimeout(() => {
        btn.innerHTML = `
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--success);">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Connected!
        `;
        btn.style.borderColor = 'var(--success)';
        btn.style.color = 'var(--success)';
        
        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.disabled = false;
          btn.style.borderColor = '';
          btn.style.color = '';
        }, 2000);
      }, 1500);
    }

    // Test GitHub Connection
    function testGitHubConnection() {
      const btn = event.target.closest('button');
      const originalHTML = btn.innerHTML;
      
      btn.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;">
          <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
        </svg>
        Testing...
      `;
      btn.disabled = true;
      
      // Simulate connection test
      setTimeout(() => {
        btn.innerHTML = `
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--success);">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Connected!
        `;
        btn.style.borderColor = 'var(--success)';
        btn.style.color = 'var(--success)';
        
        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.disabled = false;
          btn.style.borderColor = '';
          btn.style.color = '';
        }, 2000);
      }, 1500);
    }

    // Toggle all global agents when master checkbox is clicked
    function toggleAllGlobalAgents(masterCheckbox) {
      const checkboxes = document.querySelectorAll('.global-agent-checkbox');
      checkboxes.forEach(cb => cb.checked = masterCheckbox.checked);
      updateGlobalAgentsMaster();
    }

    // Update master checkbox state based on individual checkboxes
    function updateGlobalAgentsMaster() {
      const checkboxes = document.querySelectorAll('.global-agent-checkbox');
      const master = document.getElementById('global-agents-master');
      const countEl = document.getElementById('global-agents-count');
      
      const total = checkboxes.length;
      const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
      
      if (checked === 0) {
        master.checked = false;
        master.indeterminate = false;
        countEl.textContent = '0 agents selected';
      } else if (checked === total) {
        master.checked = true;
        master.indeterminate = false;
        countEl.textContent = `${total} agents selected`;
      } else {
        master.checked = false;
        master.indeterminate = true;
        countEl.textContent = `${checked} of ${total} agents selected`;
      }
    }

    // Toggle all global MCP when master checkbox is clicked
    function toggleAllGlobalMCP(masterCheckbox) {
      const checkboxes = document.querySelectorAll('.global-mcp-checkbox');
      checkboxes.forEach(cb => cb.checked = masterCheckbox.checked);
      updateGlobalMCPMaster();
    }

    // Update master MCP checkbox state based on individual checkboxes
    function updateGlobalMCPMaster() {
      const checkboxes = document.querySelectorAll('.global-mcp-checkbox');
      const master = document.getElementById('global-mcp-master');
      const countEl = document.getElementById('global-mcp-count');
      
      const total = checkboxes.length;
      const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
      
      // Update row opacity based on checked state
      checkboxes.forEach(cb => {
        const row = cb.closest('div[style*="padding: 8px"]');
        if (row) {
          row.style.opacity = cb.checked ? '1' : '0.5';
          const statusEl = row.querySelector('div[style*="font-size: 10px"]');
          if (statusEl && !cb.checked) {
            statusEl.textContent = 'Not selected';
            statusEl.style.color = 'var(--text-muted)';
          }
        }
      });
      
      if (checked === 0) {
        master.checked = false;
        master.indeterminate = false;
        countEl.textContent = '0 servers selected';
      } else if (checked === total) {
        master.checked = true;
        master.indeterminate = false;
        countEl.textContent = `${total} servers selected`;
      } else {
        master.checked = false;
        master.indeterminate = true;
        countEl.textContent = `${checked} of ${total} servers selected`;
      }
    }

    // Handle .md file upload for project brief
    function handleBriefUpload(input) {
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('project-brief').value = e.target.result;
        };
        reader.readAsText(file);
      }
    }

    // Start project definition with AI
    function startProjectDefinition() {
      const brief = document.getElementById('project-brief').value.trim();
      
      if (!brief) {
        alert('Please describe your project first');
        return;
      }
      
      // Show the AI chat area
      const chatArea = document.getElementById('ai-brief-chat');
      chatArea.style.display = 'block';
      
      // Scroll to chat
      chatArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
      
      // Focus input
      setTimeout(() => {
        document.getElementById('ai-chat-input').focus();
      }, 300);
    }

    // Collapse AI chat
    function collapseAIChat() {
      document.getElementById('ai-brief-chat').style.display = 'none';
    }

    // Send message in brief chat
    let questionCount = 3; // Start at 3 since demo already has messages
    function sendBriefMessage() {
      const input = document.getElementById('ai-chat-input');
      const message = input.value.trim();
      
      if (!message) return;
      
      const chatMessages = document.getElementById('brief-chat-messages');
      
      // Add user message
      chatMessages.innerHTML += `
        <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
          <div style="background: var(--primary); color: white; border-radius: 8px; padding: 10px 14px; font-size: 13px; max-width: 80%;">
            ${message}
          </div>
        </div>
      `;
      
      input.value = '';
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // Simulate AI response
      setTimeout(() => {
        chatMessages.innerHTML += `
          <div style="display: flex; gap: 10px; margin-bottom: 16px;">
            <div style="width: 28px; height: 28px; background: linear-gradient(135deg, #D97757 0%, #C4694A 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; color: white;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                <path d="M12 2L14.5 9H22L16 14L18.5 21L12 16.5L5.5 21L8 14L2 9H9.5L12 2Z" fill="currentColor"/>
              </svg>
            </div>
            <div style="flex: 1; background: var(--bg-tertiary); border-radius: 8px; padding: 12px; font-size: 13px; line-height: 1.5;">
              Thanks for the additional details! I've noted that. Is there anything else you'd like to add, or should we proceed to generate your project configuration?
            </div>
          </div>
        `;
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 800);
    }
    // Continue conversation (hide action buttons)
    function continueConversation() {
      document.getElementById('ai-chat-input').focus();
    }

    // Toggle voice input (Whisper)
    let isRecording = false;
    function toggleVoiceInput() {
      const voiceBtn = document.getElementById('voice-btn');
      const recordingIndicator = document.getElementById('voice-recording');
      
      if (!isRecording) {
        // Start recording
        isRecording = true;
        voiceBtn.style.color = 'var(--error)';
        recordingIndicator.style.display = 'block';
        
        // Simulate recording (in real app, this would use Web Audio API + Whisper)
        // For demo, we'll stop after 3 seconds and add sample text
        setTimeout(() => {
          if (isRecording) {
            toggleVoiceInput(); // Stop recording
            document.getElementById('ai-chat-input').value = 'Just me and my family, about 5 people total';
          }
        }, 3000);
      } else {
        // Stop recording
        isRecording = false;
        voiceBtn.style.color = 'var(--text-muted)';
        recordingIndicator.style.display = 'none';
      }
    }

    // Generate project context from brief
    function generateProjectContext() {
      const brief = document.getElementById('project-brief').value;
      
      if (!brief.trim()) {
        alert('Please enter a project brief first');
        return;
      }
      
      // Simulate LLM generation (in real app, this would call API)
      document.getElementById('ctx-tech-stack').value = 'Node.js, Express, PostgreSQL, Redis';
      document.getElementById('ctx-standards').value = 'TypeScript strict mode, async/await patterns, JSDoc comments, ESLint + Prettier';
      document.getElementById('context-generated-badge').style.display = 'inline-block';
      
      // Add chat message showing generation
      const chatMessages = document.getElementById('brief-chat-messages');
      chatMessages.innerHTML += `
        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
          <div style="width: 20px; height: 20px; background: var(--primary); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; flex-shrink: 0;"></div>
          <div style="background: var(--bg-secondary); padding: 8px 12px; border-radius: 8px; font-size: 12px; color: var(--text-secondary);">
             Generated project context! I detected Node.js with Express, PostgreSQL for data, and Redis for caching. Feel free to edit the fields below.
          </div>
        </div>
      `;
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // Scroll to context section
      document.getElementById('ctx-tech-stack').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Save/Submit project context
    function submitProjectContext() {
      const techStack = document.getElementById('ctx-tech-stack').value.trim();
      const standards = document.getElementById('ctx-standards').value.trim();
      
      if (!techStack && !standards) {
        alert('Please fill in at least the tech stack or code standards');
        return;
      }
      
      // Show success feedback
      const badge = document.getElementById('context-generated-badge');
      badge.textContent = ' Saved';
      badge.style.display = 'inline-block';
      badge.style.background = 'rgba(34, 197, 94, 0.2)';
      badge.style.color = 'var(--success)';
      
      // Brief flash effect
      const panel = document.getElementById('ctx-tech-stack').closest('.settings-panel');
      panel.style.borderColor = 'var(--success)';
      setTimeout(() => {
        panel.style.borderColor = 'var(--border)';
      }, 1500);
    }

    // ==================== AGENT MODAL FUNCTIONS ====================
    let editingAgentId = null;
    let selectedAgentIcon = '';

    function showAgentModal(editMode = false, agentData = null) {
      document.getElementById('agent-modal-overlay').classList.add('show');
      document.getElementById('agent-modal').classList.add('show');
      
      if (editMode && agentData) {
        editingAgentId = agentData.id;
        document.getElementById('agent-modal-title').textContent = 'Edit Agent';
        document.getElementById('agent-save-text').textContent = 'Save Changes';
        document.getElementById('agent-name').value = agentData.name || '';
        document.getElementById('agent-description').value = agentData.description || '';
        document.getElementById('agent-model').value = agentData.model || 'sonnet';
        document.getElementById('agent-tools').value = agentData.tools || 'readonly';
        document.getElementById('agent-prompt').value = agentData.prompt || '';
        selectedAgentIcon = agentData.icon || '';
      } else {
        editingAgentId = null;
        document.getElementById('agent-modal-title').textContent = 'Create New Agent';
        document.getElementById('agent-save-text').textContent = 'Create Agent';
        document.getElementById('agent-name').value = '';
        document.getElementById('agent-description').value = '';
        document.getElementById('agent-model').value = 'sonnet';
        document.getElementById('agent-tools').value = 'readonly';
        document.getElementById('agent-prompt').value = '';
        selectedAgentIcon = '';
      }
      
      // Update icon picker
      document.querySelectorAll('#agent-modal .icon-picker').forEach(btn => {
        btn.style.borderColor = btn.textContent === selectedAgentIcon ? 'var(--primary)' : 'var(--border)';
      });
    }

    function hideAgentModal() {
      document.getElementById('agent-modal-overlay').classList.remove('show');
      document.getElementById('agent-modal').classList.remove('show');
      editingAgentId = null;
    }

    function selectAgentIcon(btn, icon) {
      selectedAgentIcon = icon;
      document.querySelectorAll('#agent-modal .icon-picker').forEach(b => {
        b.style.borderColor = 'var(--border)';
      });
      btn.style.borderColor = 'var(--primary)';
    }

    function saveAgent() {
      const name = document.getElementById('agent-name').value.trim();
      const description = document.getElementById('agent-description').value.trim();
      
      if (!name) {
        alert('Please enter an agent name');
        return;
      }
      
      // In real app, this would save to backend
      console.log('Saving agent:', {
        id: editingAgentId,
        name,
        description,
        icon: selectedAgentIcon,
        model: document.getElementById('agent-model').value,
        tools: document.getElementById('agent-tools').value,
        prompt: document.getElementById('agent-prompt').value
      });
      
      hideAgentModal();
      // Show success message
      alert(editingAgentId ? 'Agent updated!' : 'Agent created!');
    }

    // ==================== SKILL MODAL FUNCTIONS ====================
    let editingSkillId = null;
    let selectedSkillIcon = '';

    function showSkillModal(editMode = false, skillData = null) {
      document.getElementById('skill-modal-overlay').classList.add('show');
      document.getElementById('skill-modal').classList.add('show');
      
      if (editMode && skillData) {
        editingSkillId = skillData.id;
        document.getElementById('skill-modal-title').textContent = 'Edit Skill';
        document.getElementById('skill-save-text').textContent = 'Save Changes';
        document.getElementById('skill-name').value = skillData.name || '';
        document.getElementById('skill-description').value = skillData.description || '';
        document.getElementById('skill-content').value = skillData.content || '';
        selectedSkillIcon = skillData.icon || '';
      } else {
        editingSkillId = null;
        document.getElementById('skill-modal-title').textContent = 'Create New Skill';
        document.getElementById('skill-save-text').textContent = 'Create Skill';
        document.getElementById('skill-name').value = '';
        document.getElementById('skill-description').value = '';
        document.getElementById('skill-content').value = '';
        selectedSkillIcon = '';
      }
      
      // Update icon picker
      document.querySelectorAll('#skill-modal .icon-picker').forEach(btn => {
        btn.style.borderColor = btn.textContent === selectedSkillIcon ? 'var(--primary)' : 'var(--border)';
      });
    }

    function hideSkillModal() {
      document.getElementById('skill-modal-overlay').classList.remove('show');
      document.getElementById('skill-modal').classList.remove('show');
      editingSkillId = null;
    }

    function selectSkillIcon(btn, icon) {
      selectedSkillIcon = icon;
      document.querySelectorAll('#skill-modal .icon-picker').forEach(b => {
        b.style.borderColor = 'var(--border)';
      });
      btn.style.borderColor = 'var(--primary)';
    }

    function saveSkill() {
      const name = document.getElementById('skill-name').value.trim();
      const description = document.getElementById('skill-description').value.trim();
      
      if (!name) {
        alert('Please enter a skill name');
        return;
      }
      
      console.log('Saving skill:', {
        id: editingSkillId,
        name,
        description,
        icon: selectedSkillIcon,
        content: document.getElementById('skill-content').value
      });
      
      hideSkillModal();
      alert(editingSkillId ? 'Skill updated!' : 'Skill created!');
    }

    // ==================== MCP SERVER MODAL FUNCTIONS ====================
    let editingMCPId = null;
    let selectedMCPType = 'database';

    function showMCPModal(editMode = false, mcpData = null) {
      document.getElementById('mcp-modal-overlay').classList.add('show');
      document.getElementById('mcp-modal').classList.add('show');
      
      if (editMode && mcpData) {
        editingMCPId = mcpData.id;
        document.getElementById('mcp-modal-title').textContent = 'Edit MCP Server';
        document.getElementById('mcp-save-text').textContent = 'Save Changes';
        // Populate fields based on mcpData
      } else {
        editingMCPId = null;
        document.getElementById('mcp-modal-title').textContent = 'Add MCP Server';
        document.getElementById('mcp-save-text').textContent = 'Add Server';
        // Reset fields
        document.getElementById('mcp-connection').value = '';
        document.getElementById('mcp-name').value = '';
      }
      
      selectMCPType(document.querySelector('.mcp-type-option'), 'database');
    }

    function hideMCPModal() {
      document.getElementById('mcp-modal-overlay').classList.remove('show');
      document.getElementById('mcp-modal').classList.remove('show');
      editingMCPId = null;
    }

    function selectMCPType(element, type) {
      selectedMCPType = type;
      document.querySelectorAll('.mcp-type-option').forEach(opt => {
        opt.style.borderColor = 'var(--border)';
      });
      element.style.borderColor = 'var(--primary)';
      
      // Show/hide appropriate options
      document.getElementById('mcp-database-options').style.display = type === 'database' ? 'block' : 'none';
      document.getElementById('mcp-api-options').style.display = type === 'api' ? 'block' : 'none';
      document.getElementById('mcp-custom-options').style.display = type === 'custom' ? 'block' : 'none';
    }

    function updateMCPIcon() {
      // Update icon based on selected database type
    }

    function testMCPConnection() {
      alert('Testing connection... (simulated)');
    }

    function saveMCP() {
      let name = '';
      if (selectedMCPType === 'database') {
        name = document.getElementById('mcp-name').value.trim();
        const connection = document.getElementById('mcp-connection').value.trim();
        if (!connection) {
          alert('Please enter a connection string');
          return;
        }
      }
      
      console.log('Saving MCP server:', {
        id: editingMCPId,
        type: selectedMCPType,
        name
      });
      
      hideMCPModal();
      alert(editingMCPId ? 'Server updated!' : 'Server added!');
    }

    // Toggle Settings Agent Help section
    function toggleSettingsAgentHelp() {
      const content = document.getElementById('settings-agent-help-content');
      const chevron = document.getElementById('settings-agent-help-chevron');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        chevron.style.transform = 'rotate(90deg)';
      } else {
        content.style.display = 'none';
        chevron.style.transform = 'rotate(0deg)';
      }
    }

    // Toggle Settings MCP Help section
    function toggleSettingsMCPHelp() {
      const content = document.getElementById('settings-mcp-help-content');
      const chevron = document.getElementById('settings-mcp-help-chevron');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        chevron.style.transform = 'rotate(90deg)';
      } else {
        content.style.display = 'none';
        chevron.style.transform = 'rotate(0deg)';
      }
    }

    // Toggle Settings MCP Warning tooltip
    function toggleSettingsMCPWarning() {
      const tooltip = document.getElementById('settings-mcp-warning-tooltip');
      tooltip.style.display = tooltip.style.display === 'none' ? 'block' : 'none';
    }

    // Toggle Agent Help section
    function toggleAgentHelp() {
      const content = document.getElementById('agent-help-content');
      const chevron = document.getElementById('agent-help-chevron');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        chevron.style.transform = 'rotate(90deg)';
      } else {
        content.style.display = 'none';
        chevron.style.transform = 'rotate(0deg)';
      }
    }

    // Toggle MCP Help section
    function toggleMCPHelp() {
      const content = document.getElementById('mcp-help-content');
      const chevron = document.getElementById('mcp-help-chevron');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        chevron.style.transform = 'rotate(90deg)';
      } else {
        content.style.display = 'none';
        chevron.style.transform = 'rotate(0deg)';
      }
    }

    // Toggle Global Agents dropdown
    function toggleGlobalAgents() {
      const list = document.getElementById('global-agents-list');
      const chevron = document.getElementById('global-agents-chevron');
      if (list.style.display === 'none') {
        list.style.display = 'block';
        chevron.style.transform = 'rotate(0deg)';
      } else {
        list.style.display = 'none';
        chevron.style.transform = 'rotate(-90deg)';
      }
    }

    // Toggle Global MCP dropdown
    function toggleGlobalMCP() {
      const list = document.getElementById('global-mcp-list');
      const chevron = document.getElementById('global-mcp-chevron');
      if (list.style.display === 'none') {
        list.style.display = 'block';
        chevron.style.transform = 'rotate(0deg)';
      } else {
        list.style.display = 'none';
        chevron.style.transform = 'rotate(-90deg)';
      }
    }

    // Toggle MCP Warning tooltip
    function toggleMCPWarning() {
      const tooltip = document.getElementById('mcp-warning-tooltip');
      tooltip.style.display = tooltip.style.display === 'none' ? 'block' : 'none';
    }

    // Toggle Agent menu
    function toggleAgentMenu(btn) {
      const menu = btn.nextElementSibling;
      document.querySelectorAll('.agent-menu, .mcp-menu').forEach(m => {
        if (m !== menu) m.style.display = 'none';
      });
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }

    // Toggle MCP menu
    function toggleMCPMenu(btn) {
      const menu = btn.nextElementSibling;
      document.querySelectorAll('.agent-menu, .mcp-menu').forEach(m => {
        if (m !== menu) m.style.display = 'none';
      });
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }

    // Close menus when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.agent-menu') && !e.target.closest('.mcp-menu') && !e.target.closest('button')) {
        document.querySelectorAll('.agent-menu, .mcp-menu').forEach(m => m.style.display = 'none');
      }
      // Close MCP warning when clicking outside
      if (!e.target.closest('#mcp-warning-tooltip') && !e.target.closest('[onclick="toggleMCPWarning()"]')) {
        const tooltip = document.getElementById('mcp-warning-tooltip');
        if (tooltip) tooltip.style.display = 'none';
      }
      // Close Settings MCP warning when clicking outside
      if (!e.target.closest('#settings-mcp-warning-tooltip') && !e.target.closest('[onclick="toggleSettingsMCPWarning()"]')) {
        const tooltip = document.getElementById('settings-mcp-warning-tooltip');
        if (tooltip) tooltip.style.display = 'none';
      }
    });

    // Workspace tree toggle
    function toggleWorkspace(element) {
      const arrow = element.querySelector('span:last-child');
      const children = element.nextElementSibling;
      if (children && children.classList.contains('workspace-children')) {
        if (children.style.display === 'none') {
          children.style.display = 'block';
          arrow.textContent = '';
        } else {
          children.style.display = 'none';
          arrow.textContent = '';
        }
      }
    }

    // Toggle Dashboard Sidebar panel
    let dashboardSidebarOpen = true;
    function toggleDashboardSidebar() {
      dashboardSidebarOpen = !dashboardSidebarOpen;
      const sidebar = document.getElementById('dashboard-sidebar');
      const toggle = document.getElementById('dashboard-sidebar-toggle');
      
      if (dashboardSidebarOpen) {
        sidebar.classList.remove('collapsed');
        if (toggle) {
          toggle.textContent = '';
        }
      } else {
        sidebar.classList.add('collapsed');
        if (toggle) {
          toggle.textContent = '';
        }
      }
    }

    // Dev panel toggle
    let devPanelOpen = false;
    function toggleDevPanel() {
      devPanelOpen = !devPanelOpen;
      const panel = document.getElementById('llm-dev-panel');
      const content = document.getElementById('dev-panel-content');
      const arrow = document.getElementById('dev-panel-arrow');
      
      // Also hide other tab contents
      const dockerContent = document.getElementById('tab-docker-content');
      const logsContent = document.getElementById('tab-logs-content');
      const promptContent = document.getElementById('tab-prompt-content');
      
      if (devPanelOpen) {
        panel.style.height = '300px';
        content.style.display = 'flex';
        arrow.textContent = '';
      } else {
        panel.style.height = '40px';
        content.style.display = 'none';
        if (dockerContent) dockerContent.style.display = 'none';
        if (logsContent) logsContent.style.display = 'none';
        if (promptContent) promptContent.style.display = 'none';
        arrow.textContent = '';
      }
    }

    // Dev tabs
    function showDevTab(tab) {
      // Hide all content panels
      document.getElementById('dev-panel-content').style.display = 'none';
      document.getElementById('tab-docker-content').style.display = 'none';
      document.getElementById('tab-logs-content').style.display = 'none';
      document.getElementById('tab-prompt-content').style.display = 'none';

      // Show selected
      if (tab === 'terminal') {
        document.getElementById('dev-panel-content').style.display = 'flex';
      } else if (tab === 'docker') {
        document.getElementById('tab-docker-content').style.display = 'flex';
      } else if (tab === 'logs') {
        document.getElementById('tab-logs-content').style.display = 'flex';
      } else if (tab === 'prompt') {
        document.getElementById('tab-prompt-content').style.display = 'flex';
      }
      
      // Update active state
      document.querySelectorAll('.llm-dev-tabs button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
    }

    // File explorer toggle
    let fileExplorerOpen = true;
    function toggleFileExplorer() {
      fileExplorerOpen = !fileExplorerOpen;
      const panel = document.getElementById('file-explorer-panel');
      const iconBtn = document.getElementById('workspaces-icon-btn');
      if (fileExplorerOpen) {
        panel.style.display = 'flex';
        panel.style.width = '220px';
        if (iconBtn) iconBtn.classList.add('active');
      } else {
        panel.style.display = 'none';
        if (iconBtn) iconBtn.classList.remove('active');
      }
    }

    // Tree item toggle (expand/collapse folders)
    function toggleTreeItem(element) {
      const arrow = element.querySelector('span:first-child');
      const nextEl = element.nextElementSibling;
      if (nextEl && nextEl.classList.contains('file-tree-children')) {
        if (nextEl.style.display === 'none') {
          nextEl.style.display = 'block';
          arrow.textContent = '';
        } else {
          nextEl.style.display = 'none';
          arrow.textContent = '';
        }
      }
    }

    // Mic toggle
    function toggleMic(btn) {
      btn.classList.toggle('recording');
      if (btn.classList.contains('recording')) {
        btn.title = 'Recording... Click to stop';
      } else {
        btn.title = 'Voice input (Whisper)';
      }
    }

    // Preview panel toggle
    let previewOpen = false;
    function togglePreview() {
      previewOpen = !previewOpen;
      const panel = document.getElementById('preview-panel');
      const toggleBtn = panel.querySelector('.preview-toggle');
      
      if (previewOpen) {
        panel.classList.remove('collapsed');
        toggleBtn.textContent = '';
        toggleBtn.title = 'Collapse preview';
      } else {
        panel.classList.add('collapsed');
        toggleBtn.textContent = '';
        toggleBtn.title = 'Expand preview';
      }
    }

    // Preview device mode
    function setPreviewDevice(device, btn) {
      const frame = document.getElementById('preview-frame');
      const panel = document.getElementById('preview-panel');
      const container = document.querySelector('.preview-frame-container');
      const buttons = document.querySelectorAll('.device-btn');
      const sizeLabel = document.getElementById('device-size-label');
      const chatPanel = document.getElementById('chat-panel');
      
      // Remove active from all buttons
      buttons.forEach(b => b.classList.remove('active'));
      
      // Add active to clicked button
      btn.classList.add('active');
      
      // Update frame class
      frame.classList.remove('phone', 'tablet', 'desktop');
      frame.classList.add(device);
      
      // Reset chat panel to flex
      chatPanel.style.flex = '1';
      chatPanel.style.width = 'auto';
      
      // Set panel and frame widths for each device
      if (device === 'phone') {
        panel.style.flex = 'none';
        panel.style.width = '420px';
        panel.style.minWidth = '420px';
        frame.style.width = '375px';
        frame.style.minWidth = '375px';
        frame.style.maxWidth = '375px';
        sizeLabel.textContent = '375px';
      } else if (device === 'tablet') {
        panel.style.flex = 'none';
        panel.style.width = '820px';
        panel.style.minWidth = '820px';
        frame.style.width = '768px';
        frame.style.minWidth = '768px';
        frame.style.maxWidth = '768px';
        sizeLabel.textContent = '768px';
      } else {
        panel.style.flex = 'none';
        panel.style.width = '1340px';
        panel.style.minWidth = '1340px';
        frame.style.width = '1280px';
        frame.style.minWidth = '1280px';
        frame.style.maxWidth = '1280px';
        sizeLabel.textContent = '1280px';
      }
      
      // Reset scroll position
      if (container) {
        container.scrollLeft = 0;
      }
    }
    
    // Reset preview to fit panel
    function resetPreviewSize(btn) {
      const frame = document.getElementById('preview-frame');
      const panel = document.getElementById('preview-panel');
      const container = document.querySelector('.preview-frame-container');
      const sizeLabel = document.getElementById('device-size-label');
      const buttons = document.querySelectorAll('.device-btn');
      const chatPanel = document.getElementById('chat-panel');
      
      // Remove active from all buttons, add to the one clicked (fit button)
      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Reset chat panel to flex
      chatPanel.style.flex = '1';
      chatPanel.style.width = 'auto';
      
      // Reset panel to flex (equal split)
      panel.style.flex = '1';
      panel.style.width = 'auto';
      panel.style.minWidth = '200px';
      
      // Set frame to auto-fit
      frame.classList.remove('phone', 'tablet', 'desktop');
      frame.style.width = '100%';
      frame.style.minWidth = 'auto';
      frame.style.maxWidth = '100%';
      sizeLabel.textContent = 'Fit';
      
      // Reset scroll
      if (container) {
        container.scrollLeft = 0;
      }
    }

    // Connection status toggle
    function toggleConnection() {
      const status = document.querySelector('.connection-status');
      if (status.classList.contains('connected')) {
        status.classList.remove('connected');
        status.classList.add('disconnected');
        status.innerHTML = 'Disconnected';
        status.title = 'Click to reconnect';
      } else {
        status.classList.remove('disconnected');
        status.classList.add('connected');
        status.innerHTML = 'Connected';
        status.title = 'Click to disconnect';
      }
    }

    // Settings tab switching
    function showSettingsTab(tab) {
      // Hide all settings sections
      document.querySelectorAll('.settings-section').forEach(section => {
        section.style.display = 'none';
      });
      
      // Show selected section
      const targetSection = document.getElementById('settings-' + tab);
      if (targetSection) {
        targetSection.style.display = 'block';
      }
      
      // Update subnav active state
      document.querySelectorAll('.settings-subnav-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('onclick')?.includes(tab)) {
          item.classList.add('active');
        }
      });
    }

    // Cross-LLM checkbox toggle
    function toggleCrossLLM() {
      const checkbox = document.getElementById('cross-llm-checkbox');
      const options = document.getElementById('cross-llm-options');
      if (checkbox.checked) {
        options.style.display = 'block';
      } else {
        options.style.display = 'none';
      }
    }

    // Resizable dev panel
    const resizer = document.getElementById('dev-panel-resizer');
    const devPanel = document.getElementById('llm-dev-panel');
    let isResizing = false;

    resizer.addEventListener('mousedown', (e) => {
      isResizing = true;
      document.body.style.cursor = 'ns-resize';
      document.body.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', (e) => {
      if (!isResizing) return;
      const containerRect = devPanel.parentElement.getBoundingClientRect();
      const newHeight = containerRect.bottom - e.clientY;
      if (newHeight > 40 && newHeight < 500) {
        devPanel.style.height = newHeight + 'px';
      }
    });

    document.addEventListener('mouseup', () => {
      isResizing = false;
      document.body.style.cursor = 'default';
      document.body.style.userSelect = 'auto';
    });

    // Resizable vertical panes in LLM-Dev
    let isResizingExplorer = false;
    let isResizingTerminal = false;

    const resizerExplorer = document.getElementById('resizer-explorer');
    const resizerTerminal = document.getElementById('resizer-terminal');
    const fileExplorer = document.getElementById('dev-file-explorer');
    const editorArea = document.getElementById('dev-editor-area');
    const terminalArea = document.getElementById('dev-terminal-area');

    if (resizerExplorer) {
      resizerExplorer.addEventListener('mousedown', (e) => {
        isResizingExplorer = true;
        document.body.style.cursor = 'ew-resize';
        document.body.style.userSelect = 'none';
      });
    }

    if (resizerTerminal) {
      resizerTerminal.addEventListener('mousedown', (e) => {
        isResizingTerminal = true;
        document.body.style.cursor = 'ew-resize';
        document.body.style.userSelect = 'none';
      });
    }

    document.addEventListener('mousemove', (e) => {
      if (isResizingExplorer && fileExplorer) {
        const containerRect = fileExplorer.parentElement.getBoundingClientRect();
        const newWidth = e.clientX - containerRect.left;
        if (newWidth > 150 && newWidth < 400) {
          fileExplorer.style.width = newWidth + 'px';
          fileExplorer.style.minWidth = newWidth + 'px';
        }
      }
      if (isResizingTerminal && terminalArea) {
        const containerRect = terminalArea.parentElement.getBoundingClientRect();
        const newWidth = containerRect.right - e.clientX;
        if (newWidth > 200 && newWidth < 600) {
          terminalArea.style.width = newWidth + 'px';
        }
      }
    });

    document.addEventListener('mouseup', () => {
      isResizingExplorer = false;
      isResizingTerminal = false;
      document.body.style.cursor = 'default';
      document.body.style.userSelect = 'auto';
    });

    // Resizable chat/preview panels
    let isResizingChatPreview = false;
    const resizerChatPreview = document.getElementById('resizer-chat-preview');
    const chatPanel = document.getElementById('chat-panel');
    const previewPanel = document.getElementById('preview-panel');

    if (resizerChatPreview) {
      resizerChatPreview.addEventListener('mousedown', (e) => {
        isResizingChatPreview = true;
        document.body.style.cursor = 'ew-resize';
        document.body.style.userSelect = 'none';
      });
    }

    document.addEventListener('mousemove', (e) => {
      if (isResizingChatPreview && chatPanel && previewPanel) {
        const containerRect = chatPanel.parentElement.getBoundingClientRect();
        const chatWidth = e.clientX - containerRect.left;
        const previewWidth = containerRect.right - e.clientX;
        
        // Respect min widths only - allow scrolling in preview for larger content
        const minChatWidth = 300;
        const minPreviewWidth = 200;
        
        if (chatWidth > minChatWidth && previewWidth > minPreviewWidth) {
          chatPanel.style.flex = 'none';
          chatPanel.style.width = chatWidth + 'px';
          previewPanel.style.flex = 'none';
          previewPanel.style.width = previewWidth + 'px';
          previewPanel.style.minWidth = previewWidth + 'px';
        }
      }
    });

    document.addEventListener('mouseup', () => {
      if (isResizingChatPreview) {
        isResizingChatPreview = false;
        document.body.style.cursor = 'default';
        document.body.style.userSelect = 'auto';
      }
    });

    // Blinking cursor animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  </script>

</body>
</html>
